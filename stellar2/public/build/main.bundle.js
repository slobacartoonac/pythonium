(()=>{"use strict";var t,e,n,i,s,r,a={},o={};function h(t){var e=o[t];if(void 0!==e)return e.exports;var n=o[t]={id:t,loaded:!1,exports:{}};return a[t](n,n.exports,h),n.loaded=!0,n.exports}function c(){}function l(){this._entities=new Set,this._components=new Map}function u(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function p(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function d(t,e,n,i){return i?{x:(e.x-t.x+(i.x-n.x))/2,y:(e.y-t.y+(i.y-n.y))/2}:{x:e.x-t.x,y:e.y-t.y}}function g(t,e,n,i){if(!i)return 1;if(!n)return 1;let s=u(t,n),r=u(e,i);return s<.01?1:r/s}function m(t,e,n,i){if(!i)return 0;let s=f(t,n);return f(e,i)-s}function f(t,e){let n=d(t,e);return Math.atan2(n.y,n.x)}function y(t,e){this.deadzone=e,this.clear();let n=null,i=null,s=null,r=null,a=null,o=0,h=!0,c=!1,l=!1;this.centerPosition={x:0,y:0},this.debug=!1,this.console_error=!1,this.throw_error=!1,this.last_error="";const f=t=>{t.preventDefault();const{top:e,left:n}=t.target.getBoundingClientRect();if(t.touches[1]&&t.touches[0]){let i={x:t.touches[0].clientX-n,y:t.touches[0].clientY-e},s={x:t.touches[1].clientX-n,y:t.touches[1].clientY-e};return this.centerPosition={x:(i.x+s.x)/2,y:(i.y+s.y)/2},v(i,s)}if(t.touches[0]){let i={x:t.touches[0].clientX-n,y:t.touches[0].clientY-e};return this.centerPosition={x:i.x,y:i.y},v(i)}},y=t=>{t.preventDefault();const{top:e,left:n}=t.target.getBoundingClientRect();this.centerPosition={x:t.clientX-n,y:t.clientY-e},o&&v({x:t.clientX-n,y:t.clientY-e})},v=(t,e)=>{if(c=!0,null==n)return n={x:t.x,y:t.y},i=+new Date,r={x:t.x,y:t.y},this.triger("start",r),void(h=!0);if(e&&null==s)return l=!0,u(n,e)<u(n,t)&&(n={x:t.x,y:t.y},i=+new Date,r={x:t.x,y:t.y}),s={x:e.x,y:e.y},void(a={x:e.x,y:e.y});if(!e&&s)return l=!1,s=null,void(a=null);let f=d(r,t,a,e),y=g(r,t,a,e),v=m(r,t,a,e);r={x:t.x,y:t.y},a=e?{x:e.x,y:e.y}:null;let x=d(n,r,s,a),w=g(n,r,s,a),b=p(x),M=m(n,r,s,a),S=+new Date-i,E=this.debug&&`${n&&"Start: "+JSON.stringify(n)},\n\t\t${r&&"This: "+JSON.stringify(r)}, \n\t\t${s&&"Start secound: "+JSON.stringify(s)}, \n\t\t${a&&"Start this: "+JSON.stringify(a)},\n\t\t${f&&"Delta: "+JSON.stringify(f)},\n\t\t${"Zoom: "+w},\n\t\t${"DZoom: "+y}\n\t\t${"Angle: "+M}\n\t\t${"DAngle: "+v}\n\t\t${"isPrimary: "+(!l&&0==o||1==o)}\n\t\t${this.last_error}`,_={delta:f,direction:x,startPosition:n,position:r,distance:b,click:h,isClick:h,mouseDown:o,zoom:w,deltaZoom:y,touchSecound:l,angle:M,deltaAngle:v,startTime:i,deltaTime:S,isPrimary:!l&&0==o||1==o,debug:E,centerPosition:this.centerPosition};this.triger("force",_),b>this.deadzone&&(h=!1,Math.abs(x.x)>Math.abs(x.y)?x.x>0?this.triger("right",_):this.triger("left",_):x.y>0?this.triger("down",_):this.triger("up",_))},x=t=>{if(t.preventDefault(),0==c)return;let e={x:0,y:0},u=d(n,r,s,a),f=g(n,r,s,a),y=m(n,r,s,a),v=p(u),x=+new Date-i,w=this.debug&&`${n&&"Start: "+JSON.stringify(n)},\n\t\t${r&&"This: "+JSON.stringify(r)}, \n\t\t${s&&"Start secound: "+JSON.stringify(s)}, \n\t\t${a&&"Start this: "+JSON.stringify(a)},\n\t\t${e&&"Delta: "+JSON.stringify(e)},\n\t\t${"Zoom: "+f},\n\t\tDZoom: 0\n\t\t${"Angle: "+y}\n\t\tDAngle: 0\n\t\t${"isPrimary: "+(!l&&0==o||1==o)}\n\t\t${this.last_error}`;const b={x:n.x,y:n.y,delta:e,direction:u,startPosition:n,position:r,distance:v,click:h,isClick:h,mouseDown:o,zoom:f,deltaZoom:0,touchSecound:l,angle:y,deltaAngle:0,startTime:i,deltaTime:x,isPrimary:!l&&0==o||1==o,debug:w,centerPosition:this.centerPosition};c=!1,l=!1;let M=n;h&&(t.button&&(1===t.button&&this.triger("bmiddle",b),2===t.button&&this.triger("bright",b)),M&&this.triger("click",b)),this.triger("stop",b),n=null,i=null,r=null,s=null,a=null,o=0};t.addEventListener("touchstart",(t=>{t.preventDefault()}),!1),t.addEventListener("touchmove",f,!1),t.addEventListener("touchend",x,!1),t.addEventListener("touchstart",f,!1),t.addEventListener("mouseleave",x,!1),t.addEventListener("mousemove",y),t.addEventListener("mouseup",x),t.addEventListener("mousedown",(t=>{o=1+t.button,y(t)}))}h.m=a,t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=t=>{t&&!t.d&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},h.a=(s,r,a)=>{var o;a&&((o=[]).d=1);var h,c,l,u=new Set,p=s.exports,d=new Promise(((t,e)=>{l=e,c=t}));d[e]=p,d[t]=t=>(o&&t(o),u.forEach(t),d.catch((t=>{}))),s.exports=d,r((s=>{var r;h=(s=>s.map((s=>{if(null!==s&&"object"==typeof s){if(s[t])return s;if(s.then){var r=[];r.d=0,s.then((t=>{a[e]=t,i(r)}),(t=>{a[n]=t,i(r)}));var a={};return a[t]=t=>t(r),a}}var o={};return o[t]=t=>{},o[e]=s,o})))(s);var a=()=>h.map((t=>{if(t[n])throw t[n];return t[e]})),c=new Promise((e=>{(r=()=>e(a)).r=0;var n=t=>t!==o&&!u.has(t)&&(u.add(t),t&&!t.d&&(r.r++,t.push(r)));h.map((e=>e[t](n)))}));return r.r?c:a()}),(t=>(t?l(d[n]=t):c(p),i(o)))),o&&(o.d=0)},h.d=(t,e)=>{for(var n in e)h.o(e,n)&&!h.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},h.f={},h.e=t=>Promise.all(Object.keys(h.f).reduce(((e,n)=>(h.f[n](t,e),e)),[])),h.u=t=>t+".bundle.js",h.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),h.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s={},r="stellar2:",h.l=(t,e,n,i)=>{if(s[t])s[t].push(e);else{var a,o;if(void 0!==n)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var u=c[l];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==r+n){a=u;break}}a||(o=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,h.nc&&a.setAttribute("nonce",h.nc),a.setAttribute("data-webpack",r+n),a.src=t),s[t]=[e];var p=(e,n)=>{a.onerror=a.onload=null,clearTimeout(d);var i=s[t];if(delete s[t],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((t=>t(n))),e)return e(n)},d=setTimeout(p.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=p.bind(null,a.onerror),a.onload=p.bind(null,a.onload),o&&document.head.appendChild(a)}},h.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},h.v=(t,e,n,i)=>{var s=fetch(h.p+""+n+".module.wasm");return"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,i).then((e=>Object.assign(t,e.instance.exports))):s.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,i))).then((e=>Object.assign(t,e.instance.exports)))},h.p="build/",(()=>{var t={179:0};h.f.j=(e,n)=>{var i=h.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var s=new Promise(((n,s)=>i=t[e]=[n,s]));n.push(i[2]=s);var r=h.p+h.u(e),a=new Error;h.l(r,(n=>{if(h.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var s=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+s+": "+r+")",a.name="ChunkLoadError",a.type=s,a.request=r,i[1](a)}}),"chunk-"+e,e)}};var e=(e,n)=>{var i,s,[r,a,o]=n,c=0;if(r.some((e=>0!==t[e]))){for(i in a)h.o(a,i)&&(h.m[i]=a[i]);o&&o(h)}for(e&&e(n);c<r.length;c++)s=r[c],h.o(t,s)&&t[s]&&t[s][0](),t[s]=0},n=self.webpackChunkstellar2=self.webpackChunkstellar2||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),l.prototype.create=function(){var t=this.make_entity();return this._entities.add(t),this._components.set(t,new Map),t},l.prototype.make_entity=function(){return new c},l.prototype.alive=function(t){return this._entities.has(t)},l.prototype.destroy=function(t){this._components.delete(t),this._entities.delete(t)},l.prototype.asign=function(t,e){if(!e)throw Error("Can't asign to "+e);if(!(e instanceof c))throw Error(e+" is not Entity");var n=this._components.get(e);if(!n)throw Error(e+" not Entity form this set");var i=n.get(t.constructor.name);if(i){if(i&&n.get(t.constructor.name).has(t))throw Error("Component is allready asiged");i.add(t)}else this._components.get(e).set(t.constructor.name,new Set([t]))},l.prototype.get=function(t,e){var n=this._components.get(e);if(!n)return[];var i=n.get(t.name);return i?Array.from(i):[]},l.prototype.remove=function(t,e){var n=this._components.get(e);if(n){var i=n.get(t.constructor.name);i&&i.delete(t)}},l.prototype.getEnities=function(t){return[...this._entities.values()].filter((e=>e&&this.get(t,e).length))},y.prototype.sub=function(t,e){this.events[t]&&this.events[t].push(e)},y.prototype.onClick=function(t){this.events.click.push(t)},y.prototype.onForce=function(t){this.events.force.push(t)},y.prototype.onStart=function(t){this.events.start.push(t)},y.prototype.onStop=function(t){this.events.stop.push(t)},y.prototype.onUp=function(t){this.events.up.push(t)},y.prototype.onDown=function(t){this.events.down.push(t)},y.prototype.onLeft=function(t){this.events.left.push(t)},y.prototype.onRight=function(t){this.events.right.push(t)},y.prototype.unsub=function(t,e){this.events[t]&&(this.events[t]=this.events[t].filter((t=>t!==e)))},y.prototype.clearEvlent=function(t){this.events[t]&&(this.events[t]=[])},y.prototype.clear=function(){this.events={up:[],down:[],left:[],right:[],stop:[],start:[],click:[],force:[],bmiddle:[],bright:[]}},y.prototype.triger=function(t,e){this.events[t]&&this.events[t].forEach((t=>{try{t(e)}catch(t){if(this.console_error&&console.log(t),this.last_error="Error: "+t.name+" "+t.foo+" "+t.message+" "+t.stack,this.throw_error)throw t}}))};const v=y;function x(){const t=[...arguments];if(Array.call(this),1==t.length){var e=Object.values(t[0]);this.push(...e)}else this.push(...Object.values(t));Object.defineProperty(this,"x",{get(){return this[0]},set(t){this[0]=t}}),Object.defineProperty(this,"y",{get(){return this[1]},set(t){this[1]=t}}),Object.defineProperty(this,"z",{get(){return this[2]},set(t){this[2]=t}}),Object.defineProperty(this,"length",{enumerable:!1,writable:!0})}function w(t){this.positions=new x(t)}function b(t,e,n){this.speeds=new x(t),this.mass=e,this.drag=isNaN(n)?.001:n,this.maxSpeed=100}function M(t,e){this.manager=t,this.engines=e}function S(t){this.radius=t}function E(){}function _(t){this.manager=t,this.physic_entity=null}function k(t,e){var n=[];return e.forEach((e=>{if(e!=t){var i=e.positions[0]-t.positions[0],s=e.positions[1]-t.positions[1],r=t.radius+e.radius;Math.abs(i)>r||Math.abs(s)>r||function(t,e){for(var n=0,i=0;i<t.positions.length;i++)n+=Math.pow(t.positions[i]-e.positions[i],2);return n}(t,e)>Math.pow(r,2)||t.radius>e.radius&&n.push(e)}})),n}function P(t,e){this.manager=t,this.interaction=e||.1}function D(t,e,n){var i=[0,0];return e.forEach((e=>{if(e!=t){var s=e.positions[0]-t.positions[0],r=e.positions[1]-t.positions[1],a=s*s+r*r,o=Math.sqrt(a),h=e.mass/a*n;i[0]+=s/o*h,i[1]+=r/o*h}})),i}function A(t,e){this.x=t,this.y=e}function T(t,e){this.font=t,this.text=e}function O(t){this.image=t}function N(t){this.radius=t}function I(t){this.rotate=t}function j(){this.noscale=!0}function C(t){this.scale=t}function W(t,e,n){this.image=t,this.x=e,this.y=n}function $(){}function B(t,e,n){this.color=t,this.stroke=e,this.layer=n||0}function L(t,e){this.context=t,this.manager=e,this.maxSize=100}function F(t,e){e.color&&(t.fillStyle=e.color,t.fill()),e.stroke&&(t.strokeStyle=e.stroke.color,t.lineWidth=e.stroke.width,t.stroke())}function q(t,e,n,i,s,r){t.moveTo(e,n+r),t.lineTo(e,n+s-r),t.arcTo(e,n+s,e+r,n+s,r),t.lineTo(e+i-r,n+s),t.arcTo(e+i,n+s,e+i,n+s-r,r),t.lineTo(e+i,n+r),t.arcTo(e+i,n,e+i-r,n,r),t.lineTo(e+r,n),t.arcTo(e,n,e,n+r,r)}function R(t){this.manager=t}x.from=function(t){return new x(t)},x.prototype.x=0,x.prototype.y=0,x.prototype.z=0,x.prototype=Object.create(Array.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}),x.prototype.add=function(t){let e=this.copy();for(var n in e)Object.hasOwnProperty.call(t,n)&&(e[n]+=t[n]);return e},Object.defineProperty(x.prototype,"add",{enumerable:!1}),x.prototype.update=function(t){let e=Object.entries(t);for(var n=0;n<e.length;n++){let t=e[n];Object.hasOwnProperty.call(this,t[0])&&(this[n]=t[1])}},Object.defineProperty(x.prototype,"update",{enumerable:!1}),x.prototype.negate=function(){let t=this.copy();for(var e in this)t[e]=-t[e];return t},Object.defineProperty(x.prototype,"negate",{enumerable:!1}),x.prototype.substract=function(t){return this.add(t.negate())},Object.defineProperty(x.prototype,"substract",{enumerable:!1}),x.prototype.magnitude=function(){let t=0;for(var e of this)t+=e*e;return Math.sqrt(t)},Object.defineProperty(x.prototype,"magnitude",{enumerable:!1}),x.prototype.normalise=function(t){let e=this.magnitude();return e?this.scale(1/e):this.scale(0)},Object.defineProperty(x.prototype,"normalise",{enumerable:!1}),x.prototype.scale=function(t){let e=this.copy();for(var n in this)e[n]*=t;return e},Object.defineProperty(x.prototype,"scale",{enumerable:!1}),x.prototype.copy=function(){return new x(this)},Object.defineProperty(x.prototype,"copy",{enumerable:!1}),b.prototype.applyForce=function(t){for(var e=0;e<this.speeds.length;e++){if(isNaN(t[e]))throw new Error("Physics.prototype.applyForce got NnN");this.speeds[e]+=t[e]/this.mass}},b.prototype.applyAsc=function(t){for(var e=0;e<this.speeds.length;e++){if(isNaN(t[e]))throw new Error("Physics.prototype.applyAsc got NnN");this.speeds[e]+=t[e]}},b.prototype.compute=function(){var t,e=0;for(t=0;t<this.speeds.length;t++)e+=this.speeds[t]*this.speeds[t];var n=Math.min(1-this.drag,this.maxSpeed/e);for(t=0;t<this.speeds.length;t++)this.speeds[t]*=n},M.prototype.compute=function(){this.engines.forEach((t=>t.compute())),this.manager.getEnities(b).forEach((t=>{var e=this.manager.get(b,t)[0];e.compute();var n=this.manager.get(w,t)[0];n.positions=n.positions.add(e.speeds)}))},_.prototype.compute=function(){for(var t=this.manager.getEnities(b).filter((t=>this.manager.get(E,t)[0])).map((t=>{var e=this.manager.get(S,t)[0],n=this.manager.get(w,t)[0],i=this.manager.get(b,t)[0];return{e:t,radius:e.radius,circle:e,positions:n.positions,speeds:i.speeds,physics:i}})),e=0;e<t.length;e++){var n=t[e];if(this.manager.alive(n.e)){var i=k(n,t);for(var s in i){var r=i[s];this.manager.alive(r.e)&&(this.manager.destroy(r.e),this.merge(n,r))}}}},_.prototype.merge=function(t,e){var n=Math.pow(t.radius,3),i=Math.pow(e.radius,3),s=Math.cbrt(n+i);t.circle.radius=s;var r=t.physics.mass,a=e.physics.mass;t.physics.mass=r+a;for(var o=0;o<t.speeds.length;o++)t.speeds[o]=(t.speeds[o]*r+e.speeds[o]*a)/(r+a)},P.prototype.compute=function(){for(var t=this.manager.getEnities(b).map((t=>{var e=this.manager.get(b,t)[0],n=this.manager.get(w,t)[0];return{e:t,mass:e.mass,physics:e,positions:n.positions}})),e=0;e<t.length;e++){var n=t[e],i=D(n,t,this.interaction);n.physics.applyAsc(i)}},$.render=function(t,e,n,i,s){for(let r=0;r<n;r+=s)for(let a=0;a<e;a+=i){let o=Math.min(i,e-a),h=Math.min(s,n-r);this.context.drawImage(t,a,r,o,h)}},L.prototype.draw=function(t){const{context:e}=this;var n=e.canvas.clientWidth,i=e.canvas.clientHeight;const{x:s,y:r,scale:a,angle:o}=t,h=n/2,c=i/2,l=this.maxSize*a;o&&(e.save(),e.translate(h,c),e.rotate(o),e.translate(-h,-c)),this.manager.getEnities(B).map((t=>[t,this.manager.get(B,t)[0]])).sort((([,t],[,e])=>t.layer<e.layer?-1:t.layer>e.layer?1:0)).map((([t,o])=>{var u=this.manager.get(w,t).reduce(((t,e)=>(t[0]+=e.positions[0],t[1]+=e.positions[1],t)),[0,0]),p=(u[0]-s)*a+h,d=(u[1]-r)*a+c;if(p<-l||d<-l||p>n||d>i)return;let g=this.manager.get(j,t)[0],m=this.manager.get(C,t)[0],f=g?1:a*(m?.scale||1),y=this.manager.get(S,t);for(let t in y){let n=y[t];const i=n.radius*f>1?n.radius*f:1;e.beginPath(),e.arc(p,d,i,0,2*Math.PI,!1),F(e,o)}let v=this.manager.get(A,t),x=this.manager.get(N,t),b=this.manager.get(I,t)[0];for(let t in v){let n=v[t];const i=n.x*f>1?n.x*f:1,s=n.y*f>1?n.y*f:1;e.save(),b&&(e.translate(p+i/2,d+s/2),e.rotate(b.rotate),e.translate(-p-i/2,-d-s/2)),e.beginPath(),x[0]?q(e,p,d,i,s,x[0].radius):e.rect(p,d,i,s),F(e,o),e.restore()}let M=this.manager.get(O,t);for(let t in M){let n=M[t],i=v[0],s=i?.x||n.image.width,r=i?.y||n.image.height;const a=s*f>1?s*f+.5:1,o=r*f>1?r*f+.5:1;e.save(),b&&(e.translate(p+a/2,d+o/2),e.rotate(b.rotate),e.translate(-p-a/2,-d-o/2)),e.drawImage(n.image,p,d,a,o),e.restore()}this.manager.get(W,t).forEach((t=>{let n=v[0],i=n?.x||t.image.width,s=n?.y||t.image.height;const r=i*f>1?i*f+.5:1,a=r/i,o=s*f>1?s*f+.5:1;e.save(),b&&(e.translate(p+r/2,d+o/2),e.rotate(b.rotate),e.translate(-p-r/2,-d-o/2)),e.translate(p,d),$.render.call(this,t.image,r,o,t.x*a,t.y*a,e),e.restore()}));let E=this.manager.get(T,t);for(let t in E){let n=E[t];const i=n.font*f>1?n.font*f:1;e.fillStyle=o.color,e.font=parseInt(i)+"px serif",e.save(),b&&(e.translate(p,d),e.rotate(b.rotate),e.translate(-p,-d)),e.fillText(n.text,p,d+parseInt(i)),e.restore()}})),o&&e.restore()},L.prototype.mesure=function(t){const{context:e}=this;return e.font=parseInt(t.font)+"px serif",e.measureText(t.text)};const H=[[245,202,117],[254,255,188],[200,141,110]];function J(t){let e=t.toString(16);return e.length-1?e:"0"+e}function z(t,e,n,i,s,r,a){return[(r-t)*n+i/2,(a-e)*n+s/2]}function Z(t,e,n,i,s,r,a){return[(r-i/2)/n+t,(a-s/2)/n+e]}function X(t){this.canvas=t,this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this.img=this.context.createImageData(this.canvas.width,this.canvas.height)}R.prototype.compute=function(){this.manager.getEnities(B).map((t=>{var e=this.manager.get(B,t)[0],n=this.manager.get(b,t)[0].mass/(Math.pow(this.manager.get(S,t)[0].radius,3)*Math.PI)*H.length*3,i=Math.min(Math.round(n),H.length-1);e.color="#"+J(H[i][0])+J(H[i][1])+J(H[i][2])}))},X.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},X.prototype.getCanvas=function(){return this.canvas},X.prototype.worldToScreen=function(t,e){const{width:n,height:i}=this.canvas,{x:s,y:r,scale:a}=t;return z(s,r,a,n,i,e[0],e[1])},X.prototype.screenToWorld=function(t,e){const{width:n,height:i}=this.canvas,{x:s,y:r,scale:a}=t;return Z(s,r,a,n,i,e[0],e[1])};const Y=X;function U(t){this.context=t,this.time=(new Date).getTime(),this.i=0,this.fps=0}U.prototype.draw=function(){this.i++;var t=(new Date).getTime(),e=t-this.time;this.time=t,this.context.font="14px Verdana",this.i%30||(this.fps=Math.round(1e4/e)/10+" fps"),this.context.beginPath(),this.context.rect(10,13,60,14),this.context.fillStyle="gray",this.context.fill(),this.context.fillStyle="red",this.context.fillText(this.fps,10,24)};const V=U;function G(t,e,n){return t*(1-n)+e*n}function K(t,e){this.context=t,this.showCords=e?.showCords,this.showAxis=e?.showAxis,this.axisCords=e?.axisCords,this.axisScale=e?.axisScale||100,this.devide=e?.devide||2}K.prototype.draw=function(t,e,n){const{context:i}=this;var s=i.canvas.clientWidth,r=i.canvas.clientHeight;const{x:a,y:o,scale:h}=n,c=s/2,l=r/2;for(var u=h||1;u>2;)u/=2;for(;u<1;)u*=2;const p=t*u,d=e*u;if((y=(c-a*h)%p)<0&&(y+=p),(v=(l-o*h)%d)<0&&(v+=d),this.showAxis){i.beginPath();let[t,e]=z(a,o,h,s,r,0,0);i.lineWidth=2,i.moveTo(t,0),i.lineTo(t,r),i.moveTo(0,e),i.lineTo(s,e),i.strokeStyle="rgba(0, 0, 0, 1.0)",i.stroke()}i.beginPath();for(var g=y;g<=s;g+=p){if(i.moveTo(g,0),i.lineTo(g,r),!this.axisCords)continue;let t=Z(a,o,h,s,r,g,0)[0];this.drawCod(t,0,n,i)}for(var m=v;m<=r;m+=d){if(i.moveTo(0,m),i.lineTo(s,m),!this.axisCords)continue;let t=Z(a,o,h,s,r,0,m)[1];this.drawCod(0,t,n,i)}i.lineWidth=2,i.strokeStyle="rgba(128, 128, 128, 0.5)",i.stroke();for(var f=0;f<this.devide-1;f++){var y=(y+p/this.devide)%p,v=(v+d/this.devide)%d;for(i.beginPath(),g=y;g<=s;g+=p)i.moveTo(g,0),i.lineTo(g,r);for(m=v;m<=r;m+=d)i.moveTo(0,m),i.lineTo(s,m);i.lineWidth=1,i.strokeStyle="rgba(128, 128, 128, "+G(.25,.5,u-1)+")",i.stroke()}this.showCords&&(i.font="10px Arial",i.fillText(Math.round(n.x*this.axisScale)/this.axisScale+Number.EPSILON+","+Math.round(n.y*this.axisScale+Number.EPSILON)/this.axisScale+","+Math.round(n.scale*this.axisScale+Number.EPSILON)/this.axisScale,10,50))},K.prototype.drawCod=function(t,e,n,i){const{x:s,y:r,scale:a}=n;var o=i.canvas.clientWidth,h=i.canvas.clientHeight,c=(t-s)*a+o/2,l=(e-r)*a+h/2;let u=!1;function p(t){return+parseFloat(t).toFixed(2)}(c<5||c>o-19||l>h-28||l<14)&&(u=!0),c<5&&(c=5),l<14&&(l=14),c>o-19&&(c=o-19),l>h-28&&(l=h-28),i.font="14px Verdana",i.fillStyle="rgb(0, 0, 0, 1.0)";let d="",g=p(t/this.axisScale),m=p(-e/this.axisScale);g&&(d+=g),m&&(d+=m),m||g||u||(d+="0"),i.fillText(d,c+5,l+14)},K.prototype.line=function(t,e,n,i,s){this.context.lineWidth=1,this.context.moveTo(t,e),this.context.lineTo(t+n,e+i),this.context.strokeStyle=s,this.context.stroke()};const Q=K;function tt(t,e){this.context=t,this.update(),this.manager=e}tt.prototype.update=function(){this.width=this.context.canvas.clientWidth,this.height=this.context.canvas.clientHeight,this.img=this.context.createImageData(this.width,this.height)},tt.prototype.pull=function(){this.img=this.context.getImageData(0,0,this.width,this.height)},tt.prototype.imgRect=function(t,e,n,i,s){null==s[3]&&s.push(Math.min(2*((t,e)=>{for(var n=0,i=0;i<t.length;i++)n+=(t[i]-e[i])*(t[i]-e[i]);return isNaN(n)||n<1?1:Math.sqrt(n)})(s,[0,0,0]),255));const r=Math.max(Math.min(n,this.width-t),0),a=Math.max(Math.min(i,this.height-e),0),o=Math.max(Math.round(t),0),h=Math.max(Math.round(e),0),c=this.img.data,l=4*o,u=4*r+l,p=4*this.width,d=h*p,g=a*p+d,m=s[3]/255;for(var f=d;f<g;f+=p)for(var y=l;y<u;y+=4){var v=f+y;c[v]=G(c[v],s[0],m),c[v+1]=G(c[v+1],s[1],m),c[v+2]=G(c[v+2],s[2],m),c[v+3]=Math.max(s[3],c[v+3])}};const et=(t,e)=>{for(var n=0,i=0;i<t.length;i++)n+=Math.pow(t[i]-e.positions[i],2);return isNaN(n)||n<1?1:n};function nt(t,e){this.context=t,this.imgData=new tt(t,e),this.manager=e}nt.prototype.update=function(){this.imgData.update()},nt.prototype.draw=function(t){const{x:e,y:n,scale:i}=t,{context:s}=this;var r=s.canvas.clientWidth,a=s.canvas.clientHeight;const o=r/2,h=a/2;var c=(e+o)%2,l=(n+h)%2,u=2/i;const p=this.manager.getEnities(b).map((t=>{var e=this.manager.get(b,t)[0],n=this.manager.get(w,t)[0];return{mass:e.mass,positions:n.positions}}));this.imgData.pull();for(var d=c;d<=r;d+=2)for(var g=(d-o)/i+e,m=(l-h)/i+n,f=l;f<=a;f+=2){for(var y=0,v=p.length,x=0;x<v;x++){var M=p[x];y+=3e3*M.mass/et([g,m],M)}var S=Math.min(y/16,255),E=Math.max(Math.min(y,255)-S*S*.3,0);this.imgData.imgRect(d-1,f-1,2,2,[S,0,E]),m+=u}s.putImageData(this.imgData.img,0,0)},nt.prototype.imgRect=function(t,e,n,i,s){const r=Math.max(Math.min(n,this.context.canvas.clientWidth-t),0),a=Math.max(Math.min(i,this.context.canvas.clientHeight-e),0),o=Math.max(Math.round(t),0),h=Math.max(Math.round(e),0),c=this.img.data,l=4*o,u=4*r+l,p=4*this.context.canvas.clientWidth,d=h*p,g=a*p+d;for(var m=d;m<g;m+=p)for(var f=l;f<u;f+=4){var y=m+f;c[y]=s[0],c[y+1]=s[1],c[y+2]=s[2],c[y+3]=s[3]}};const it=nt,st=(t,e)=>{for(var n=0,i=0;i<t.length;i++)n+=(t[i]-e[i])*(t[i]-e[i]);return isNaN(n)||n<1?1:Math.sqrt(n)};function rt(t,e,n){this.colors=n,this.context=t,this.imgData=new tt(t,e),this.manager=e}rt.prototype.update=function(){this.imgData.update()},rt.prototype.draw=function(t){const{x:e,y:n,scale:i}=t,{context:s}=this;var r=s.canvas.clientWidth,a=s.canvas.clientHeight;const o=r/2,h=a/2;var c=(e+o)%2,l=(n+h)%2,u=2/i;const p=this.manager.getEnities(b).map((t=>{var e=this.manager.get(b,t)[0],n=this.manager.get(w,t)[0];return{mass:e.mass,positions:n.positions}}));this.imgData.pull();for(var d=new Array(this.colors.length).fill(0),g=c;g<=r;g+=2)for(var m=(g-o)/i+e,f=(l-h)/i+n,y=l;y<=a;y+=2){for(var v=0,x=p.length,M=0;M<x;M++){var S=p[M];v+=S.mass/st([m,f],S.positions)}var E=Math.max(this.colors.length-v/64,0),_=E%1,k=Math.min(this.colors.length-1,Math.floor(E)),P=Math.min(this.colors.length-1,Math.ceil(E)),D=this.colors[P];let t=this.colors[k];d[k]++,D=D.map(((e,n)=>G(t[n],e,_))),this.imgData.imgRect(g-1,y-1,2,2,[D[0],D[1],D[2]]),f+=u}s.putImageData(this.imgData.img,0,0)};const at=rt;function ot(t,e){this.context=t,this.imgData=new tt(t,e),this.update(),this.manager=e}ot.prototype.update=function(){this.width=this.context.canvas.clientWidth,this.height=this.context.canvas.clientHeight,this.step=4,this.widthSteps=this.width/this.step,this.heightSteps=this.height/this.step,this.number=this.widthSteps*this.heightSteps,this.cells={p:new Float32Array(this.number),v:new Float32Array(this.number),h:new Float32Array(this.number),o:new Uint8Array(this.number)},this.cells.p.fill(1),this.cells.v.fill(0),this.cells.h.fill(0),this.cells.o.fill(0),this.imgData.update()},ot.prototype.draw=function(t){const{x:e,y:n,scale:i}=t,{context:s}=this;var r=s.canvas.clientWidth,a=s.canvas.clientHeight;const o=r/2,h=a/2,c=this.step,l=this.step,u=c/2,p=l/2;var d=(e+o)%c,g=(n+h)%l,m=l/i;this.imgData.pull();const f=this.manager.getEnities(b).map((t=>{var e=this.manager.get(w,t)[0],n=this.manager.get(S,t)[0];return{speeds:this.manager.get(b,t)[0].speeds,radius:n&&n.radius,positions:e.positions}})).filter((({radius:t})=>!!t));for(var y=d;y<=r;y+=c)for(var v=(y-o)/i+e,x=(g-h)/i+n,M=Math.max(Math.round(v-u),0),E=g;E<=a;E+=l){for(var _=M+Math.max(Math.round(x-p),0)*this.widthSteps,k=0,P=f.length,D=0;D<P;D++){var A=f[D];A.radius>(N=A.positions[0],I=A.positions[1],function(t,e){return Math.sqrt(t*t+e*e)}(N-v,I-x))&&(this.cells.o[_]=1)}this.cells[_]&&(k+=128);var T=Math.min(k,255),O=Math.max(Math.min(k,255)-T*T*.3,0);this.imgData.imgRect(y-u,E-p,c,l,[255-O,0,255-T]),x+=m}var N,I;s.putImageData(this.imgData.img,0,0)};const ht=ot,ct=t=>Math.atan(5*(t-1))+Math.pow(t-1,3);function lt(t,e,n=ct){this.connects=t,this.distance=e,this.force=n}function ut(t){this.manager=t}ut.prototype.compute=function(){this.manager.getEnities(lt).map((t=>{var e=this.manager.get(lt,t).map((t=>({transform:this.manager.get(w,t.connects)[0],distance:t.distance,force:t.force}))),n=this.manager.get(w,t)[0],i=this.manager.get(b,t)[0],s=function(t,e){var n=[0,0];return t.forEach((({transform:t,distance:i,force:s})=>{var r=t.positions[0]-e.positions[0],a=t.positions[1]-e.positions[1],o=Math.atan2(a,r),h=s(Math.sqrt(r*r+a*a)/i),c=Math.cos(o)*h,l=Math.sin(o)*h;n[0]+=c,n[1]+=l})),n}(e,n);i.applyForce(s)}))};const pt=document.getElementById("phy_canvas"),dt=document.getElementById("tolook_value"),gt=document.getElementById("draw_mass"),mt=document.getElementById("draw_mass_rust"),ft=document.getElementById("draw_galaxy"),yt=document.getElementById("draw_gass"),vt=document.getElementById("draw_grid"),xt=document.getElementById("draw_fps"),wt=document.getElementById("full_speed"),bt=document.getElementById("draw_planets"),Mt=document.getElementById("max_planets"),St=document.getElementById("screen_shot");console.log(St),St.onclick=()=>{var t,e;console.log("screenshot"),t=document.getElementsByTagName("canvas")[0].toDataURL("png"),(e=document.createElement("a")).href=t,e.download="image.png",e.click()};var Et=new Y(pt);pt.width=640,pt.height=480;var _t={x:0,y:0,scale:.2};window.addEventListener("mousewheel",(function(t){_t.scale*=t.wheelDelta>0?1.1:.88}));const kt=new V(Et.context),Pt=new Q(Et.context);var Dt=new l;const At=new L(Et.context,Dt),Tt=new it(Et.context,Dt),Ot=new class{constructor(t,e){this.manager=e,this.context=t,this.positionArray=new Float32Array([0,0,1]),this.planetsArray=new Float32Array([]),this.imgData=new tt(t,e),this.update()}update(){this.imgData.update(),this.width=this.context.canvas.clientWidth,this.height=this.context.canvas.clientHeight,this.gravity=null,h.e(699).then(h.bind(h,699)).then((({Gravity:t})=>{this.gravity=t.new(this.width,this.height)}))}drawAll(t){if(this.gravity){var e=this.gravity,n=this.manager.getEnities(b),i=3*n.length;this.planetsArray.length!==i&&(this.planetsArray=new Float32Array(3*n.length));var s=0;n.forEach((t=>{var e=this.manager.get(w,t)[0],n=this.manager.get(b,t)[0];this.planetsArray[s]=e.positions[0],this.planetsArray[s+1]=e.positions[1],this.planetsArray[s+2]=n.mass,s+=3})),this.positionArray[0]=t.x,this.positionArray[1]=t.y,this.positionArray[2]=t.scale,this.imgData.pull(),e.draw_planets(this.imgData.img.data,this.planetsArray,i,this.positionArray),this.context.putImageData(this.imgData.img,0,0)}}}(Et.context,Dt),Nt=new at(Et.context,Dt,[[255,255,255],[111,196,165],[163,123,173],[147,108,161],[44,78,138],[62,27,156],[100,24,29],[21,5,34],[10,12,29],[0,0,0]]),It=new ht(Et.context,Dt),jt=new P(Dt),Ct=new _(Dt),Wt=new R(Dt),$t=new ut(Dt),Bt=new M(Dt,[jt,Ct,Wt,$t]);new v(pt,100).sub("force",(({delta:t,deltaZoom:e})=>{_t={..._t,scale:_t.scale*e,x:_t.x-t.x/_t.scale,y:_t.y-t.y/_t.scale}}));var Lt=null,Ft=[];function qt(t,e,n){return Lt=Dt.create(),Dt.asign(new w(t),Lt),Dt.asign(new b(e,function(t){var e=.2+.05*Math.tanh(.2*(t-50))+.1*Math.tanh(.2*(20-t));return console.log("ffdsdf"),Math.pow(t,3)*Math.PI*e}(n),0),Lt),Dt.asign(new S(n),Lt),Dt.asign(new B("#aaffbb"),Lt),Dt.asign(new E,Lt),Lt}Ft.push(qt([0,0],[0,0],55)),Ft.push(qt([255,0],[0,5],3)),Ft.push(qt([300,0],[0,5],4)),Ft.push(qt([450,0],[0,4],7)),Ft.push(qt([600,0],[0,4],4));let Rt=qt([1400,0],[0,2.5],35);Ft.push(Rt),Ft.push(qt([1440,0],[0,6],2)),Ft.push(qt([1450,0],[0,6],2)),Ft.push(qt([2800,0],[0,2.5],5)),setInterval((()=>{let t=parseInt(Mt.value)||100;if(Ft.length<t-10)for(let t=0;t<10;t++)1,void 0,void 0,void 0,void 0,void 0,void 0,e=2*Math.random()*Math.PI,n=200+2e3*Math.random(),i=Math.sin(e)*n,s=Math.cos(e)*n,r=Math.atan2(i,s)-Math.PI/2,a=qt([i,s],[10*Math.sin(r)+14*Math.random()-7,10*Math.cos(r)+14*Math.random()-7],1),Ft.push(a);var e,n,i,s,r,a;Ft.forEach(((e,n)=>n>t&&Dt.destroy(e)))}),50),function t(){var e=parseInt(dt.value)-1;if(!isNaN(e)&&e>=0){var n=Ft[e%Ft.length],i=Dt.get(w,n)[0];_t.x=i.positions[0],_t.y=i.positions[1]}Et.clear(),vt.checked&&Pt.draw(100,100,_t),gt.checked&&Tt.draw(_t),mt.checked&&Ot.drawAll(_t),yt.checked&&It.draw(_t),ft.checked&&Nt.draw(_t),bt.checked&&At.draw(_t),xt.checked&&kt.draw(),Bt.compute(),Ft=Ft.filter((function(t,n){var i=Dt.alive(t);return!i&&!isNaN(e)&&e>=n&&(dt.value=e-1),i})),e>=Ft.length&&(dt.value=Ft.length-1),setTimeout(t,wt.checked?0:15)}()})();