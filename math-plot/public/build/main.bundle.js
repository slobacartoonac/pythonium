(()=>{var t={296:t=>{function e(t,e,n){var i,o,r,s,a;function c(){var u=Date.now()-s;u<e&&u>=0?i=setTimeout(c,e-u):(i=null,n||(a=t.apply(r,o),r=o=null))}null==e&&(e=100);var u=function(){r=this,o=arguments,s=Date.now();var u=n&&!i;return i||(i=setTimeout(c,e)),u&&(a=t.apply(r,o),r=o=null),a};return u.clear=function(){i&&(clearTimeout(i),i=null)},u.flush=function(){i&&(a=t.apply(r,o),r=o=null,clearTimeout(i),i=null)},u}e.debounce=e,t.exports=e},453:t=>{var e;self,e=()=>(()=>{"use strict";var t={738:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.evaluate=e.builtIn=void 0;const i=n(403),o=n(215);e.builtIn={pi:Math.PI,e:Math.E},e.evaluate=function t(n,r={}){switch(!0){case n instanceof o.NoopExp:return 0;case n instanceof o.BinaryExp:let s=n;return function(t,e,n){switch(n){case i.TokenType.tok_op_plus:return t+e;case i.TokenType.tok_op_minus:return t-e;case i.TokenType.tok_op_multiply:return t*e;case i.TokenType.tok_op_devide:return t/e;case i.TokenType.tok_op_power:return Math.pow(t,e);case i.TokenType.tok_op_modulo:return t%e;default:throw new Error("Operation "+n+" unknown")}}(t(s.left,r),t(s.right,r),s.op);case n instanceof o.IdentifierExp:let a=n;return void 0!==r[a.value]?r[a.value]:void 0!==e.builtIn[a.value.toLowerCase()]?e.builtIn[a.value.toLowerCase()]:-1;case n instanceof o.NumberExp:return n.value;case n instanceof o.BracketsExp:return t(n.expression,r);case n instanceof o.NegateExp:return-t(n.expression,r);case n instanceof o.FunctionExp:let c=n;return function(t,e){switch(e){case o.FunctionType.sin:return Math.sin(t);case o.FunctionType.asin:return Math.asin(t);case o.FunctionType.sinh:return Math.sinh(t);case o.FunctionType.asinh:return Math.asinh(t);case o.FunctionType.cos:return Math.cos(t);case o.FunctionType.acos:return Math.acos(t);case o.FunctionType.cosh:return Math.cosh(t);case o.FunctionType.acos:return Math.acos(t);case o.FunctionType.acosh:return Math.acosh(t);case o.FunctionType.tan:return Math.tan(t);case o.FunctionType.atan:return Math.atan(t);case o.FunctionType.tanh:return Math.tanh(t);case o.FunctionType.atanh:return Math.atanh(t);case o.FunctionType.round:return Math.round(t);case o.FunctionType.floor:return Math.floor(t);case o.FunctionType.ceil:return Math.ceil(t);case o.FunctionType.abs:return Math.abs(t);case o.FunctionType.sqrt:return Math.sqrt(t);case o.FunctionType.exp:return Math.exp(t);case o.FunctionType.ln:case o.FunctionType.log:return Math.log(t);case o.FunctionType.log10:return Math.log10(t);case o.FunctionType.factorial:return(n=t)%1?function(t){for(var e=t+1,n=Math.pow(25,t),i=1;i<25;i++)n*=i/e++;return n}(n):function(t){var e=t;if(0===t||1===t)return 1;for(;t>1;)e*=--t;return e}(n);default:throw new Error("Function "+e+" unknown")}var n}(t(c.expression,r),c.func);default:return-1}}},403:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Token=e.TokenType=e.tokenize=e.setInput=e.NumVal=e.IdentifierStr=e.getTokenElement=e.getNextToken=e.CurTok=void 0;const i=n(896);function o(){return e.CurTok=d()}function r(){switch(e.CurTok){case l.tok_identifier:return new p(l.tok_identifier,s.Col,s.Line,e.IdentifierStr);case l.tok_number:return new p(l.tok_number,s.Col,s.Line,"",e.NumVal);default:return new p(e.CurTok,s.Col,s.Line)}}e.getNextToken=o,e.getTokenElement=r;let s,a=" ",c={Line:1,Col:0};function u(t){f=t,a="",c={Line:1,Col:0},e.CurTok=null}var l;function h(){let t=function(){let t=f.split(""),e=t.shift();return void 0===e?(f="\0",i.EOF):(f=t.join(""),e)}();return"\n"==t||"\r"==t?(c.Line++,c.Col=0):c.Col++,t}e.setInput=u,e.tokenize=function(t){u(t);let n=[];for(;e.CurTok!=l.tok_eof;)o(),n.push(r());return n},function(t){t.tok_eof="tok_eof",t.tok_identifier="tok_identifier",t.tok_number="tok_number",t.tok_op_plus="tok_op_plus",t.tok_op_minus="tok_op_minus",t.tok_op_multiply="tok_op_multiply",t.tok_op_devide="tok_op_devide",t.tok_op_power="tok_op_power",t.tok_op_modulo="tok_op_modulo",t.tok_open="tok_open",t.tok_close="tok_close",t.tok_op_factorial="tok_op_factorial"}(l=e.TokenType||(e.TokenType={}));class p{constructor(t,e,n,i="",o=0){this.tokenType=t,this.column=e,this.line=n,this.str=i,this.value=o}}e.Token=p;let f="";function d(){for(;(0,i.isspace)(a);)a=h();if(s=c,(0,i.isalpha)(a)){for(e.IdentifierStr=a;(0,i.isalnum)(a=h());)e.IdentifierStr+=a;return l.tok_identifier}if((0,i.isdigit)(a)||"."==a){let t="";do{t+=a,a=h()}while((0,i.isdigit)(a)||"."==a);return e.NumVal=(0,i.strtod)(t),l.tok_number}if("+"==a)return a=h(),l.tok_op_plus;if("-"==a)return a=h(),l.tok_op_minus;if("*"==a)return a=h(),l.tok_op_multiply;if("/"==a)return a=h(),l.tok_op_devide;if("^"==a)return a=h(),l.tok_op_power;if("%"==a)return a=h(),l.tok_op_modulo;if("!"==a)return a=h(),l.tok_op_factorial;if(["{","[","("].includes(a))return a=h(),l.tok_open;if(["}","]",")"].includes(a))return a=h(),l.tok_close;if("#"==a){do{a=h()}while(a!=i.EOF&&"\n"!=a&&"\r"!=a);if(a!=i.EOF)return d()}if(a==i.EOF)return l.tok_eof;let t=a;throw a=h(),Error("Undefined token"+t+" ( "+t.charCodeAt(0)+" ) at: "+JSON.stringify(s))}},215:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getIndentifierTokens=e.parseProgram=e.FactorialExpCandidate=e.FunctionExp=e.BinaryExp=e.IdentifierExp=e.NumberExp=e.BracketsExp=e.NegateExp=e.NoopExp=e.Exp=e.functionList=e.FunctionType=void 0;const i=n(403);let o,r,s=0;function a(){return s++,o.length<=s?(s=o.length-1,new i.Token(i.TokenType.tok_eof,0,0)):(r=o[s],o[s])}function c(){return o[s]}function u(t){return c().tokenType===t}var l;function h(t){return e.functionList.includes(t.toLowerCase())}!function(t){t[t.sin=0]="sin",t[t.asin=1]="asin",t[t.sinh=2]="sinh",t[t.asinh=3]="asinh",t[t.cos=4]="cos",t[t.acos=5]="acos",t[t.cosh=6]="cosh",t[t.acosh=7]="acosh",t[t.tan=8]="tan",t[t.atan=9]="atan",t[t.tanh=10]="tanh",t[t.atanh=11]="atanh",t[t.round=12]="round",t[t.floor=13]="floor",t[t.ceil=14]="ceil",t[t.abs=15]="abs",t[t.sqrt=16]="sqrt",t[t.exp=17]="exp",t[t.log=18]="log",t[t.log10=19]="log10",t[t.ln=20]="ln",t[t.factorial=21]="factorial"}(l=e.FunctionType||(e.FunctionType={})),e.functionList=Object.keys(l);class p{}e.Exp=p,e.NoopExp=class extends p{};class f extends p{constructor(t){super(),this.expression=t}}e.NegateExp=f;class d extends p{constructor(t){super(),this.expression=t}}e.BracketsExp=d;class y extends p{constructor(t){super(),this.value=t}}e.NumberExp=y;class g extends p{constructor(t){super(),this.value=t}}e.IdentifierExp=g;class m extends p{constructor(t,e,n){super(),this.left=t,this.right=e,this.op=n}}e.BinaryExp=m;class x extends p{constructor(t,e){super(),this.expression=t,this.func=e}}e.FunctionExp=x;class v extends p{}e.FactorialExpCandidate=v;class k extends p{constructor(t){super(),this.priority=function(t){return{[i.TokenType.tok_op_plus]:1,[i.TokenType.tok_op_minus]:1,[i.TokenType.tok_op_multiply]:2,[i.TokenType.tok_op_devide]:2,[i.TokenType.tok_op_modulo]:4,[i.TokenType.tok_op_power]:5}[t]}(t),this.op=t}}function T(t){var e,n;if(u(i.TokenType.tok_eof)||u(i.TokenType.tok_close))return null;if(t&&!(t instanceof k)&&function(t=c().tokenType){return[i.TokenType.tok_op_plus,i.TokenType.tok_op_minus,i.TokenType.tok_op_multiply,i.TokenType.tok_op_devide,i.TokenType.tok_op_modulo,i.TokenType.tok_op_power].includes(t)}()){var o=c().tokenType;return a(),o==i.TokenType.tok_op_multiply&&c().tokenType==i.TokenType.tok_op_multiply?(a(),new k(i.TokenType.tok_op_power)):new k(o)}if(u(i.TokenType.tok_op_minus))return a(),new f(_());if(u(i.TokenType.tok_op_plus))return a(),T(t);if(t){if(u(i.TokenType.tok_op_factorial))return a(),new v;if(!(t instanceof k))return new k(i.TokenType.tok_op_multiply)}if(u(i.TokenType.tok_open))return function(){a();let t=_();return a(),new d(t)}();if(u(i.TokenType.tok_identifier)){let t=(null===(e=c())||void 0===e?void 0:e.str)||"";if(a(),h(t)){let e=t;return new x(T(),l[e])}return new g(t)}if(u(i.TokenType.tok_number)){let t=(null===(n=c())||void 0===n?void 0:n.value)||0;return a(),new y(t)}throw new Error("Unexpected token: "+c().tokenType+` at: (${c().column},${c().line})`)}function w(t){return t.findIndex((function(t){return t instanceof v}))}function _(){let t=null,e=[];for(;!u(i.TokenType.tok_eof)&&!u(i.TokenType.tok_close);)e.push(T(e[e.length-1]));let n=w(e);for(;n>-1;){const t=e[n-1];e.splice(n-1,2,new x(t,l.factorial)),n=w(e)}for(;e.length>1;){const t=(o=void 0,o=e.map((function(t){return t instanceof k?t.priority:0})),r=Math.max.apply(Math,o),o.indexOf(r)),n=e[t],i=e[t-1],s=e[t+1];e.splice(t-1,3,new m(i,s,n.op))}var o,r;return t=e[0],t||new y(0)}e.parseProgram=function(t){return o=(0,i.tokenize)(t),s=0,_()},e.getIndentifierTokens=function(t){o=(0,i.tokenize)(t);let e=[];for(const t of o)if(t.tokenType==i.TokenType.tok_identifier){if(h(t.str||""))continue;e.push(t.str)}return e}},896:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EOF=e.strtod=e.isalpha=e.isalnum=e.isdigit=e.isspace=void 0,e.isspace=function(t){return/\s/.test(t)||""==t},e.isdigit=function(t){return/[0-9]/.test(t)},e.isalnum=function(t){return/[a-zA-Z0-9]/.test(t)},e.isalpha=function(t){return/[a-zA-Z]/.test(t)},e.strtod=function(t){let e=parseFloat(t);return isNaN(e)?0:e},e.EOF="\0"}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}var i={};return(()=>{var t=i;Object.defineProperty(t,"__esModule",{value:!0}),t.getIndentifierTokens=t.parseProgram=t.evaluate=t.execute=void 0;const e=n(215);Object.defineProperty(t,"parseProgram",{enumerable:!0,get:function(){return e.parseProgram}}),Object.defineProperty(t,"getIndentifierTokens",{enumerable:!0,get:function(){return e.getIndentifierTokens}});const o=n(738);Object.defineProperty(t,"evaluate",{enumerable:!0,get:function(){return o.evaluate}});let r={};t.execute=function(t,n={}){let i="",s=0;try{let i=new e.NoopExp;r[t]?i=r[t]:(i=(0,e.parseProgram)(t),r[t]=i),s=(0,o.evaluate)(i,n)}catch(t){i=t.toString()}return{res:s,err:i}}})(),i})(),t.exports=e()}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";function t(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function e(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function i(t,e,n,i){return i?{x:(e.x-t.x+(i.x-n.x))/2,y:(e.y-t.y+(i.y-n.y))/2}:{x:e.x-t.x,y:e.y-t.y}}function o(e,n,i,o){if(!o)return 1;if(!i)return 1;let r=t(e,i),s=t(n,o);return r<.01?1:s/r}function r(t,e,n,i){if(!i)return 0;let o=s(t,n);return s(e,i)-o}function s(t,e){let n=i(t,e);return Math.atan2(n.y,n.x)}function a(n,s){this.deadzone=s,this.clear();let a=null,c=null,u=null,l=null,h=null,p=0,f=!0,d=!1,y=!1;this.centerPosition={x:0,y:0},this.debug=!1,this.console_error=!1,this.throw_error=!1,this.last_error="",this.preventDefault=!0;const g=t=>{this.preventDefault&&t.preventDefault();const{top:e,left:n}=t.currentTarget.getBoundingClientRect();if(t.touches[1]&&t.touches[0]){let i={x:t.touches[0].clientX-n,y:t.touches[0].clientY-e},o={x:t.touches[1].clientX-n,y:t.touches[1].clientY-e};return this.centerPosition={x:(i.x+o.x)/2,y:(i.y+o.y)/2},x(i,o)}if(t.touches[0]){let i={x:t.touches[0].clientX-n,y:t.touches[0].clientY-e};return this.centerPosition={x:i.x,y:i.y},x(i)}return v(t)},m=t=>{if(this.preventDefault&&t.preventDefault(),0===t.buttons)return void v(t);const{top:e,left:n}=t.currentTarget.getBoundingClientRect();if(this.centerPosition={x:t.clientX-n,y:t.clientY-e},p){if("drag"==t.type&&0==t.clientX&&0==t.clientY)return;x({x:t.clientX-n,y:t.clientY-e})}},x=(n,s)=>{if(d=!0,null==a)return a={x:n.x,y:n.y},c=+new Date,l={x:n.x,y:n.y},this.triger("start",l),void(f=!0);if(s&&null==u)return y=!0,t(a,s)<t(a,n)&&(a={x:n.x,y:n.y},c=+new Date,l={x:n.x,y:n.y}),u={x:s.x,y:s.y},void(h={x:s.x,y:s.y});if(!s&&u)return y=!1,u=null,void(h=null);let g=i(l,n,h,s),m=o(l,n,h,s),x=r(l,n,h,s);l={x:n.x,y:n.y},h=s?{x:s.x,y:s.y}:null;let v=i(a,l,u,h),k=o(a,l,u,h),T=e(v),w=r(a,l,u,h),_=+new Date-c,b=this.debug&&`${a&&"Start: "+JSON.stringify(a)},\n\t\t${l&&"This: "+JSON.stringify(l)}, \n\t\t${u&&"Start secound: "+JSON.stringify(u)}, \n\t\t${h&&"Start this: "+JSON.stringify(h)},\n\t\t${g&&"Delta: "+JSON.stringify(g)},\n\t\t${"Zoom: "+k},\n\t\t${"DZoom: "+m}\n\t\t${"Angle: "+w}\n\t\t${"DAngle: "+x}\n\t\t${"isPrimary: "+(!y&&0==p||1==p)}\n\t\t${this.last_error}`,S={delta:g,direction:v,startPosition:a,position:l,distance:T,click:f,isClick:f,mouseDown:p,zoom:k,deltaZoom:m,touchSecound:y,angle:w,deltaAngle:x,startTime:c,deltaTime:_,isPrimary:!y&&0==p||1==p,debug:b,centerPosition:this.centerPosition};this.triger("force",S),T>this.deadzone&&(f=!1,Math.abs(v.x)>Math.abs(v.y)?v.x>0?this.triger("right",S):this.triger("left",S):v.y>0?this.triger("down",S):this.triger("up",S))},v=t=>{if(this.preventDefault&&t.preventDefault(),0==d)return;let n={x:0,y:0},s=i(a,l,u,h),g=o(a,l,u,h),m=r(a,l,u,h),x=e(s),v=+new Date-c,k=this.debug&&`${a&&"Start: "+JSON.stringify(a)},\n\t\t${l&&"This: "+JSON.stringify(l)}, \n\t\t${u&&"Start secound: "+JSON.stringify(u)}, \n\t\t${h&&"Start this: "+JSON.stringify(h)},\n\t\t${n&&"Delta: "+JSON.stringify(n)},\n\t\t${"Zoom: "+g},\n\t\tDZoom: 0\n\t\t${"Angle: "+m}\n\t\tDAngle: 0\n\t\t${"isPrimary: "+(!y&&0==p||1==p)}\n\t\t${this.last_error}`;const T={x:a.x,y:a.y,delta:n,direction:s,startPosition:a,position:l,distance:x,click:f,isClick:f,mouseDown:p,zoom:g,deltaZoom:0,touchSecound:y,angle:m,deltaAngle:0,startTime:c,deltaTime:v,isPrimary:!y&&0==p||1==p,debug:k,centerPosition:this.centerPosition};d=!1,y=!1;let w=a;f&&(t.button&&(1===t.button&&this.triger("bmiddle",T),2===t.button&&this.triger("bright",T)),w&&this.triger("click",T)),this.triger("stop",T),a=null,c=null,l=null,u=null,h=null,p=0};n.addEventListener("touchmove",g,!1),n.addEventListener("touchend",v,!1),n.addEventListener("touchstart",g,!1),n.addEventListener("mouseleave",v,!1),n.addEventListener("mousemove",m),n.addEventListener("drag",m),n.addEventListener("mouseup",v),n.addEventListener("mousedown",(t=>{p=1+t.button,m(t)}))}function c(t,e,n,i,o,r,s){return[(r-t)*n+i/2,(s-e)*n+o/2]}function u(t,e,n,i,o,r,s){return[(r-i/2)/n+t,(s-o/2)/n+e]}function l(t){this.canvas=t,this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this.img=this.context.createImageData(this.canvas.width,this.canvas.height)}a.prototype.sub=function(t,e){this.events[t]&&this.events[t].push(e)},a.prototype.onClick=function(t){this.events.click.push(t)},a.prototype.onForce=function(t){this.events.force.push(t)},a.prototype.onStart=function(t){this.events.start.push(t)},a.prototype.onStop=function(t){this.events.stop.push(t)},a.prototype.onUp=function(t){this.events.up.push(t)},a.prototype.onDown=function(t){this.events.down.push(t)},a.prototype.onLeft=function(t){this.events.left.push(t)},a.prototype.onRight=function(t){this.events.right.push(t)},a.prototype.unsub=function(t,e){this.events[t]&&(this.events[t]=this.events[t].filter((t=>t!==e)))},a.prototype.clearEvlent=function(t){this.events[t]&&(this.events[t]=[])},a.prototype.clear=function(){this.events={up:[],down:[],left:[],right:[],stop:[],start:[],click:[],force:[],bmiddle:[],bright:[]}},a.prototype.triger=function(t,e){this.events[t]&&this.events[t].forEach((t=>{try{t(e)}catch(t){if(this.console_error&&console.log(t),this.last_error="Error: "+t.name+" "+t.foo+" "+t.message+" "+t.stack,this.throw_error)throw t}}))},l.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},l.prototype.getCanvas=function(){return this.canvas},l.prototype.worldToScreen=function(t,e){const{width:n,height:i}=this.canvas,{x:o,y:r,scale:s}=t;return c(o,r,s,n,i,e[0],e[1])},l.prototype.screenToWorld=function(t,e){const{width:n,height:i}=this.canvas,{x:o,y:r,scale:s}=t;return u(o,r,s,n,i,e[0],e[1])};const h=l;function p(t,e){this.context=t,this.showCords=e?.showCords,this.showAxis=e?.showAxis,this.axisCords=e?.axisCords,this.axisScale=e?.axisScale||100,this.devide=e?.devide||2}p.prototype.draw=function(t,e,n){const{context:i}=this;var o=i.canvas.clientWidth,r=i.canvas.clientHeight;const{x:s,y:a,scale:l}=n,h=o/2,p=r/2;for(var f=l||1;f>2;)f/=2;for(;f<1;)f*=2;const d=t*f,y=e*f;var g;if((k=(h-s*l)%d)<0&&(k+=d),(T=(p-a*l)%y)<0&&(T+=y),this.showAxis){i.beginPath();let[t,e]=c(s,a,l,o,r,0,0);i.lineWidth=2,i.moveTo(t,0),i.lineTo(t,r),i.moveTo(0,e),i.lineTo(o,e),i.strokeStyle="rgba(0, 0, 0, 1.0)",i.stroke()}i.beginPath();for(var m=k;m<=o;m+=d){if(i.moveTo(m,0),i.lineTo(m,r),!this.axisCords)continue;let t=u(s,a,l,o,r,m,0)[0];this.drawCod(t,0,n,i)}for(var x=T;x<=r;x+=y){if(i.moveTo(0,x),i.lineTo(o,x),!this.axisCords)continue;let t=u(s,a,l,o,r,0,x)[1];this.drawCod(0,t,n,i)}i.lineWidth=2,i.strokeStyle="rgba(128, 128, 128, 0.5)",i.stroke();for(var v=0;v<this.devide-1;v++){var k=(k+d/this.devide)%d,T=(T+y/this.devide)%y;for(i.beginPath(),m=k;m<=o;m+=d)i.moveTo(m,0),i.lineTo(m,r);for(x=T;x<=r;x+=y)i.moveTo(0,x),i.lineTo(o,x);i.lineWidth=1,i.strokeStyle="rgba(128, 128, 128, "+(.25*(1-(g=f-1))+.5*g)+")",i.stroke()}this.showCords&&(i.font="10px Arial",i.fillText(Math.round(n.x*this.axisScale)/this.axisScale+Number.EPSILON+","+Math.round(n.y*this.axisScale+Number.EPSILON)/this.axisScale+","+Math.round(n.scale*this.axisScale+Number.EPSILON)/this.axisScale,10,50))},p.prototype.drawCod=function(t,e,n,i){const{x:o,y:r,scale:s}=n;var a=i.canvas.clientWidth,c=i.canvas.clientHeight,u=(t-o)*s+a/2,l=(e-r)*s+c/2;let h=!1;function p(t){return+parseFloat(t).toFixed(2)}(u<5||u>a-19||l>c-28||l<14)&&(h=!0),u<5&&(u=5),l<14&&(l=14),u>a-19&&(u=a-19),l>c-28&&(l=c-28),i.font="14px Verdana",i.fillStyle="rgb(0, 0, 0, 1.0)";let f="",d=p(t/this.axisScale),y=p(-e/this.axisScale);d&&(f+=d),y&&(f+=y),y||d||h||(f+="0"),i.fillText(f,u+5,l+14)},p.prototype.line=function(t,e,n,i,o){this.context.lineWidth=1,this.context.moveTo(t,e),this.context.lineTo(t+n,e+i),this.context.strokeStyle=o,this.context.stroke()};const f=p;function d(t){this.context=t,this.scale=100}d.prototype.draw=function(t,e,n){const{context:i}=this;var o=i.canvas.clientWidth,r=i.canvas.clientHeight;const{x:s,y:a,scale:c}=t,u=o/2,l=r/2;var h=(-s*c+u)%2;i.beginPath(),i.moveTo(p,0);for(var p=h;p<=o;p+=2){var f=(-e(((p-u)/c+s)/this.scale)*this.scale-a)*c+l;isNaN(f)||(f>r+5&&(f=r+5),f<-5&&(f=-5),i.lineTo(p,f))}i.lineWidth=2;const d="string"==typeof n?n:`rgba(${n>>16&255}, ${n>>8&255}, ${255&n}, 1)`;i.strokeStyle=d||"rgba(0, 0, 0, 1)",i.stroke()};const y=d;var g=n(453);const m=[16711680,65280,255,16776960,16711935,65535];class x{constructor(t,e){this.funcArr=[],this.setProgram=t=>{this.funcArr=[],t.split(/[|;\n]+/).map((t=>t.trim())).filter((t=>t.length>0)).forEach((t=>this.addFunction(t)))},this.addFunction=t=>{let e=(0,g.getIndentifierTokens)(t),n=(0,g.parseProgram)(t);this.funcArr.push((t=>{let{res:i,err:o}=this.eval(n,{[e[0]]:t});return o?(this.input.setBaloonText(o),console.log(o)):this.input.setBaloonText(""),i}))},this.work=function(t){this.funcArr.forEach(((e,n)=>this.fPloter.draw(t,e,m[n%m.length])))},this.draw=t,this.input=e,this.fPloter=new y(t.context),this.funcArr=[]}eval(t,e){try{return{res:(0,g.evaluate)(t,e),err:null}}catch(t){return{res:null,err:t.message}}}}function v(){const t=[...arguments];if(Array.call(this),1==t.length){var e=Object.values(t[0]);this.push(...e)}else this.push(...Object.values(t));Object.defineProperty(this,"x",{get(){return this[0]},set(t){this[0]=t}}),Object.defineProperty(this,"y",{get(){return this[1]},set(t){this[1]=t}}),Object.defineProperty(this,"z",{get(){return this[2]},set(t){this[2]=t}}),Object.defineProperty(this,"length",{enumerable:!1,writable:!0})}function k(t,e){v.call(this),this.push(0,0,1,0),this.screen=t,Object.assign(this,e||{}),Object.defineProperty(this,"scale",{get(){return this[2]},set(t){this[2]=t}}),Object.defineProperty(this,"angle",{get(){return this[3]},set(t){this[3]=t}})}function T(){}function w(){this._entities=new Set,this._components=new Map}function _(t){this.positions=new v(t)}function b(t,e){this.font=t,this.text=e}function S(t,e){this.x=t,this.y=e}function E(t){this.radius=t}function P(t){this.image=t}function O(t){this.radius=t}function M(t){this.rotate=t}function N(){this.noscale=!0}function F(t){this.scale=t}function C(t,e,n){this.image=t,this.x=e,this.y=n}function j(){}function I(t){this.to=t}function L(t,e,n){this.color=t,this.stroke=e,this.layer=n||0}function W(t,e){this.context=t,this.manager=e,this.maxSize=100}function D(t,e){e.color&&(t.fillStyle=e.color,t.fill()),e.stroke&&(t.strokeStyle=e.stroke.color,t.lineWidth=e.stroke.width,t.stroke())}function $(t,e,n,i,o,r){t.moveTo(e,n+r),t.lineTo(e,n+o-r),t.arcTo(e,n+o,e+r,n+o,r),t.lineTo(e+i-r,n+o),t.arcTo(e+i,n+o,e+i,n+o-r,r),t.lineTo(e+i,n+r),t.arcTo(e+i,n,e+i-r,n,r),t.lineTo(e+r,n),t.arcTo(e,n,e,n+r,r)}function z(){this.isSelected=!1,this.index=0}v.from=function(t){return new v(t)},v.prototype.x=0,v.prototype.y=0,v.prototype.z=0,v.prototype=Object.create(Array.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),v.prototype.add=function(t){let e=this.copy();for(var n in e)Object.hasOwnProperty.call(t,n)&&(e[n]+=t[n]);return e},Object.defineProperty(v.prototype,"add",{enumerable:!1}),v.prototype.update=function(t){let e=Object.entries(t);for(var n=0;n<e.length;n++){let t=e[n];Object.hasOwnProperty.call(this,t[0])&&(this[n]=t[1])}},Object.defineProperty(v.prototype,"update",{enumerable:!1}),v.prototype.negate=function(){let t=this.copy();for(var e in this)t[e]=-t[e];return t},Object.defineProperty(v.prototype,"negate",{enumerable:!1}),v.prototype.substract=function(t){return this.add(t.negate())},Object.defineProperty(v.prototype,"substract",{enumerable:!1}),v.prototype.magnitude=function(){let t=0;for(var e of this)t+=e*e;return Math.sqrt(t)},Object.defineProperty(v.prototype,"magnitude",{enumerable:!1}),v.prototype.normalise=function(t){let e=this.magnitude();return e?this.scale(1/e):this.scale(0)},Object.defineProperty(v.prototype,"normalise",{enumerable:!1}),v.prototype.scale=function(t){let e=this.copy();for(var n in this)e[n]*=t;return e},Object.defineProperty(v.prototype,"scale",{enumerable:!1}),v.prototype.copy=function(){return new v(this)},Object.defineProperty(v.prototype,"copy",{enumerable:!1}),k.prototype=Object.create(v.prototype),k.prototype.zoom=function(t,e,n){if(this.scale*=t,!isNaN(this.minScale)&&this.scale<this.minScale)this.scale=this.minScale;else if(!isNaN(this.maxScale)&&this.scale>this.maxScale)this.scale=this.maxScale;else if(void 0!==e&&void 0!==n){let i=t-1,o=(this.screen.width/2-e)*i,r=(this.screen.height/2-n)*i;this.move(o,r)}},k.prototype.rotate=function(t){this.angle+=t,this.saveToLocalStorage()},k.prototype.move=function(t,e){let n=t/this.scale,i=e/this.scale;this.x-=n,this.y-=i,!isNaN(this.minX)&&this.x<this.minX&&(this.x=this.minX),!isNaN(this.maxX)&&this.x>this.maxX&&(this.x=this.maxX),!isNaN(this.minY)&&this.y<this.minY&&(this.y=this.minY),!isNaN(this.maxY)&&this.y>this.maxY&&(this.y=this.maxY),this.saveToLocalStorage()},k.prototype.loadFromLocalStorage=function(t){this.localStorageKey=t;let e=localStorage.getItem(this.localStorageKey);if(e){let t=JSON.parse(e);this[0]=t[0]||0,this[1]=t[1]||0,this[2]=t[2]||1,this[3]=t[3]||0}},k.prototype.saveToLocalStorage=function(){this.localStorageKey&&localStorage.setItem(this.localStorageKey,JSON.stringify(this))},w.prototype.create=function(){var t=this.make_entity();return this._entities.add(t),this._components.set(t,new Map),t},w.prototype.make_entity=function(){return new T},w.prototype.alive=function(t){return this._entities.has(t)},w.prototype.destroy=function(t){this._components.delete(t),this._entities.delete(t)},w.prototype.asign=function(t,e){if(!e)throw Error("Can't asign to "+e);if(!(e instanceof T))throw Error(e+" is not Entity");var n=this._components.get(e);if(!n)throw Error(e+" not Entity form this set");var i=n.get(t.constructor.name);if(i){if(i&&n.get(t.constructor.name).has(t))throw Error("Component is allready asiged");i.add(t)}else this._components.get(e).set(t.constructor.name,new Set([t]))},w.prototype.get=function(t,e){var n=this._components.get(e);if(!n)return[];var i=n.get(t.name);return i?Array.from(i):[]},w.prototype.remove=function(t,e){var n=this._components.get(e);if(n){var i=n.get(t.constructor.name);i&&i.delete(t)}},w.prototype.getEnities=function(t){return[...this._entities.values()].filter((e=>e&&this.get(t,e).length))},j.render=function(t,e,n,i,o){for(let r=0;r<n;r+=o)for(let s=0;s<e;s+=i){let a=Math.min(i,e-s),c=Math.min(o,n-r);this.context.drawImage(t,s,r,a,c)}},W.prototype.draw=function(t){const{context:e}=this;var n=e.canvas.clientWidth,i=e.canvas.clientHeight;const{x:o,y:r,scale:s,angle:a}=t,c=n/2,u=i/2,l=this.maxSize*s;a&&(e.save(),e.translate(c,u),e.rotate(a),e.translate(-c,-u));let h=this.manager.getEnities(L).map((t=>[t,this.manager.get(L,t)[0]])),p=new Map(h.map((([t])=>{var e=this.manager.get(_,t).reduce(((t,e)=>(t[0]+=e.positions[0],t[1]+=e.positions[1],t)),[0,0]);return[t,{x:(e[0]-o)*s+c,y:(e[1]-r)*s+u}]})));h.sort((([,t],[,e])=>t.layer<e.layer?-1:t.layer>e.layer?1:0)).map((([t,o])=>{let{x:r,y:a}=p.get(t);if(r<-l||a<-l||r>n||a>i)return;let c=this.manager.get(N,t)[0],u=this.manager.get(F,t)[0],h=c?1:s*(u?.scale||1),f=this.manager.get(E,t);for(let t in f){let n=f[t];const i=n.radius*h>1?n.radius*h:1;e.beginPath(),e.arc(r,a,i,0,2*Math.PI,!1),D(e,o)}let d=this.manager.get(S,t),y=this.manager.get(I,t),g=this.manager.get(O,t),m=this.manager.get(M,t)[0];for(let t in y){let n=y[t];if(!p.has(n.to))continue;let i=p.get(n.to);e.beginPath(),e.moveTo(r,a),e.lineTo(i.x,i.y),e.closePath(),D(e,o)}for(let t in d){let n=d[t];const i=n.x*h>1?n.x*h:1,s=n.y*h>1?n.y*h:1;e.save(),m&&(e.translate(r+i/2,a+s/2),e.rotate(m.rotate),e.translate(-r-i/2,-a-s/2)),e.beginPath(),g[0]?$(e,r,a,i,s,g[0].radius):e.rect(r,a,i,s),D(e,o),e.restore()}let x=this.manager.get(P,t);for(let t in x){let n=x[t],i=d[0],o=i?.x||n.image.width,s=i?.y||n.image.height;const c=o*h>1?o*h+.5:1,u=s*h>1?s*h+.5:1;e.save(),m&&(e.translate(r+c/2,a+u/2),e.rotate(m.rotate),e.translate(-r-c/2,-a-u/2)),e.drawImage(n.image,r,a,c,u),e.restore()}this.manager.get(C,t).forEach((t=>{let n=d[0],i=n?.x||t.image.width,o=n?.y||t.image.height;const s=i*h>1?i*h+.5:1,c=s/i,u=o*h>1?o*h+.5:1;e.save(),m&&(e.translate(r+s/2,a+u/2),e.rotate(m.rotate),e.translate(-r-s/2,-a-u/2)),e.translate(r,a),j.render.call(this,t.image,s,u,t.x*c,t.y*c,e),e.restore()}));let v=this.manager.get(b,t);for(let t in v){let n=v[t];const i=n.font*h>1?n.font*h:1;e.fillStyle=o.color,e.font=parseInt(i)+"px serif",e.save(),m&&(e.translate(r,a),e.rotate(m.rotate),e.translate(-r,-a)),e.fillText(n.text,r,a+parseInt(i)),e.restore()}})),a&&e.restore()},W.prototype.mesure=function(t){const{context:e}=this;return e.font=parseInt(t.font)+"px serif",e.measureText(t.text)};const A=(t,e,n,i,o,r,s)=>{let a=t.create();return t.asign(new _([e,n]),a),t.asign(new S(i,o),a),t.asign(new L(r,s),a),t.asign(new O(5),a),a};function X(t,e){let n=t.split(/\r?\n/),i=[];for(let t of n){if(t.length<e){i.push(t);continue}let n=t.split(" "),o="";for(let t of n)t.length>e&&(t=t.slice(0,e-4),t+="..."),o.length+t.length>e&&(i.push(o.slice(1)),o=""),o+=" "+t;o.length&&i.push(o.slice(1))}return i}function Y(){}function B(t,...e){e.forEach((e=>t.asign(new Y,e)))}function J(t){this.checked=t}class H{}class Z{constructor(t){this.ploter=t,this.manager=new w,this.render=new W(this.ploter.context,this.manager),this.input_position=new k(t.canvas),this.stabilex=30,this.stabiley=30,this.inputs={},this.baloonText=""}getWith(){return this.ploter.canvas.width}getHeight(){return this.ploter.canvas.height}setResolution(){this.input_position.x=this.getWith()/2,this.input_position.y=this.getHeight()/2}touchClick({x:t,y:e}){var n=this.ploter.screenToWorld(this.input_position,[t,e]);const i=this.manager.getEnities(z).map((t=>{var e=this.manager.get(_,t)[0],n=this.manager.get(S,t)[0],i=this.manager.get(z,t)[0];return i.index=0,{transform:e,box:n,selectable:i,id:t}})).filter((({transform:t,box:e})=>function(t,e,n){return!(t[0]>n[0]||t[1]>n[1]||t[0]+e[0]<n[0]||t[1]+e[1]<n[1])}(t.positions,[e.x,e.y],n)))[0];if(i){let t=this.manager.get(J,i.id)[0];t&&this.setState(i.id,!t.checked)}return i}addTogle(t){let e=new b(20,t),n=this.render.mesure(e).width,i=this.manager.create();this.manager.asign(new _([this.stabilex,this.stabiley]),i),this.manager.asign(new S(n+10,30),i),this.manager.asign(new L("#555555"),i),this.manager.asign(new z,i),this.manager.asign(new J(!1),i),this.all.push(i);let o=this.manager.create();return this.manager.asign(new _([this.stabilex+5,this.stabiley]),o),this.manager.asign(e,o),this.manager.asign(new L("#cccccc"),o),this.all.push(o),this.stabilex+=n+15,this.inputs[t]=i,i}getCheckedByText(t){if(!this.inputs[t])return!1;let e=this.manager.get(J,this.inputs[t])[0];return!!e&&e.checked}setState(t,e){let n=this.manager.get(L,t)[0];n&&(n.color=e?"#888888":"#555555");let i=this.manager.get(J,t)[0];i&&(i.checked=e)}setBaloonText(t){if(this.baloonText==t)return;if(this.baloonText=t,this.manager.getEnities(H).forEach((t=>{this.manager.destroy(t)})),!this.baloonText)return;let e=function(t,e,n,i,o){let r=[],s=o?.textSize||20,a=o?.lineHeight||s+10,c=o?.background||"#ffffffaa",u=o?.borderColor||"#ffffff",l=o?.borderWidth||1,h=o?.anchor||[0,0],p=o?.paddingX||o?.padding||10,f=o?.paddingY||o?.padding||10,d=o?.minWidth||0,y=o?.minHeight||0,g=o?.maxWidth||0,m=0,x=i.split(/\r?\n/).map((t=>{let n=new b(s,t),i=e.mesure(n).width,o=i+2*p;if(!g||o<g)return m=Math.max(i,m),[n];for(let n=t.length-1;0<n;n--){let i=X(t,n).map((t=>new b(s,t))),r=i.map((t=>e.mesure(t).width));if(o=Math.max(...r.map((t=>t+2*p))),o<g)return m=Math.max(m,...r),i}return[n]}));x=x.flat();let v=m+2*p;v=Math.max(d,v);let k=x.length*a+2*f;k=Math.max(y,k);let T=n[0]-v*h[0],w=n[1]-k*h[1],S=((t,e,n,i,o,r,s)=>{let a=s.width-1,c=A(t,e-a,n-a,i+2*a,o+2*a,null,{...s,width:a+2});return[A(t,e,n,i,o,r),c]})(t,T,w,v,k,c,{color:u,width:l});return r.push(...S),B(t,...S),x.map(((e,n)=>{let i=t.create();t.asign(new _([T+p,w+f+n*a]),i),t.asign(e,i),t.asign(new L("#000000",null,2),i),r.push(i),B(t,i)})),r}(this.manager,this.render,[this.getWith()-126,this.getHeight()-30],this.baloonText,{textSize:20,maxWidth:this.getWith()-136,minWidth:this.getWith()-136,anchor:[1,1],borderColor:"#aaaaaa",background:"#aaaaaaaa"});e.map((t=>this.manager.asign(new H,t)))}work(){this.render.draw(this.input_position)}}var q=n(296),R=n.n(q);const K=document.getElementById("phy_canvas");let{work:V,adjustWindowSize:U}=function(t,e){var n=new h(t),i=new Z(n),o=new k(t,{minX:-2e3,minY:-2e3,maxX:2e3,maxY:2e3,minScale:.15,maxScale:3}),r=new x(n,i),s=new a(t,20);s.throw_error=!0,window.addEventListener("mousewheel",(function(t){o.zoom(t.wheelDelta>0?1.1:.88,s.centerPosition.x,s.centerPosition.y)})),document.addEventListener("contextmenu",(function(t){t.preventDefault()}));let c=document.getElementById("program_text"),u=R()(r.setProgram,200);c.addEventListener("input",(t=>{u(t.target.value)}));const l=new f(n.context,{axisCords:!0,devide:4,showAxis:!0});let p=!1,d=!1;return s.onForce((t=>{var{delta:e,deltaZoom:n,isPrimary:i,centerPosition:r,position:s,isClick:a}=t;1!=n&&o.zoom(n,r.x,r.y),o.move(e.x,e.y)})),s.onStop((t=>{p=!1,d=!1})),s.onClick((t=>{i.touchClick(t)})),{work:function(){n.clear(),l.draw(100,100,o),r.work(o),i.work()},adjustWindowSize:function(){i.setResolution()}}}(K);window.addEventListener("resize",(()=>{K.width=window.innerWidth-10,K.height=window.innerHeight-10,U()})),K.width=window.innerWidth-10,K.height=window.innerHeight-10,U();let G=()=>{V(),setTimeout(G,0)};G()})()})();