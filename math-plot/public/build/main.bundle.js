(()=>{var t={296:t=>{function e(t,e,n){var i,o,r,s,a;function c(){var l=Date.now()-s;l<e&&l>=0?i=setTimeout(c,e-l):(i=null,n||(a=t.apply(r,o),r=o=null))}null==e&&(e=100);var l=function(){r=this,o=arguments,s=Date.now();var l=n&&!i;return i||(i=setTimeout(c,e)),l&&(a=t.apply(r,o),r=o=null),a};return l.clear=function(){i&&(clearTimeout(i),i=null)},l.flush=function(){i&&(a=t.apply(r,o),r=o=null,clearTimeout(i),i=null)},l}e.debounce=e,t.exports=e},453:t=>{var e;self,e=()=>(()=>{"use strict";var t={738:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.evaluate=e.NegateExp=void 0;const i=n(403),o=n(215);class r extends o.Exp{constructor(t){super(),this.expression=t}}e.NegateExp=r,e.evaluate=function t(e,n={}){switch(!0){case e instanceof o.NoopExp:return 0;case e instanceof o.BinaryExp:let s=e;return function(t,e,n){switch(n){case i.TokenType.tok_op_plus:return t+e;case i.TokenType.tok_op_minus:return t-e;case i.TokenType.tok_op_multiply:return t*e;case i.TokenType.tok_op_devide:return t/e;case i.TokenType.tok_op_power:return Math.pow(t,e);case i.TokenType.tok_op_modulo:return t%e;default:throw new Error("Operation "+n+" unknown")}}(t(s.left,n),t(s.right,n),s.op);case e instanceof o.IdentifierExp:return n[e.value];case e instanceof o.NumberExp:return e.value;case e instanceof o.BracketsExp:return t(e.expression,n);case e instanceof r:return-t(e.expression,n);default:return-1}}},403:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Token=e.TokenType=e.tokenize=e.setInput=e.NumVal=e.IdentifierStr=e.getTokenElement=e.getNextToken=e.CurTok=void 0;const i=n(896);function o(){return e.CurTok=d()}function r(){switch(e.CurTok){case h.tok_identifier:return new p(h.tok_identifier,s.Col,s.Line,e.IdentifierStr);case h.tok_number:return new p(h.tok_number,s.Col,s.Line,"",e.NumVal);default:return new p(e.CurTok,s.Col,s.Line)}}e.getNextToken=o,e.getTokenElement=r;let s,a=" ",c={Line:1,Col:0};function l(t){f=t,a="",c={Line:1,Col:0},e.CurTok=null}var h;function u(){let t=function(){let t=f.split(""),e=t.shift();return void 0===e?(f="\0",i.EOF):(f=t.join(""),e)}();return"\n"==t||"\r"==t?(c.Line++,c.Col=0):c.Col++,t}e.setInput=l,e.tokenize=function(t){l(t);let n=[];for(;e.CurTok!=h.tok_eof;)o(),n.push(r());return n},function(t){t.tok_eof="tok_eof",t.tok_identifier="tok_identifier",t.tok_number="tok_number",t.tok_op_plus="tok_op_plus",t.tok_op_minus="tok_op_minus",t.tok_op_multiply="tok_op_multiply",t.tok_op_devide="tok_op_devide",t.tok_op_power="tok_op_power",t.tok_op_modulo="tok_op_modulo",t.tok_open="tok_open",t.tok_close="tok_close"}(h=e.TokenType||(e.TokenType={}));class p{constructor(t,e,n,i="",o=0){this.tokenType=t,this.column=e,this.line=n,this.str=i,this.value=o}}e.Token=p;let f="";function d(){for(;(0,i.isspace)(a);)a=u();if(s=c,(0,i.isalpha)(a)){for(e.IdentifierStr=a;(0,i.isalnum)(a=u());)e.IdentifierStr+=a;return h.tok_identifier}if((0,i.isdigit)(a)||"."==a){let t="";do{t+=a,a=u()}while((0,i.isdigit)(a)||"."==a);return e.NumVal=(0,i.strtod)(t),h.tok_number}if("+"==a)return a=u(),h.tok_op_plus;if("-"==a)return a=u(),h.tok_op_minus;if("*"==a)return a=u(),h.tok_op_multiply;if("/"==a)return a=u(),h.tok_op_devide;if("^"==a)return a=u(),h.tok_op_power;if("%"==a)return a=u(),h.tok_op_modulo;if(["{","[","("].includes(a))return a=u(),h.tok_open;if(["}","]",")"].includes(a))return a=u(),h.tok_close;if("#"==a){do{a=u()}while(a!=i.EOF&&"\n"!=a&&"\r"!=a);if(a!=i.EOF)return d()}if(a==i.EOF)return h.tok_eof;let t=a;throw a=u(),Error("Undefined token"+t+" ( "+t.charCodeAt(0)+" ) at: "+JSON.stringify(s))}},215:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseProgram=e.BinaryExp=e.IdentifierExp=e.NumberExp=e.BracketsExp=e.NegateExp=e.NoopExp=e.Exp=void 0;const i=n(403);let o,r,s=0;function a(){return s++,o.length<=s?(s=o.length-1,new i.Token(i.TokenType.tok_eof,0,0)):(r=o[s],o[s])}function c(){return o[s]}function l(t){return c().tokenType===t}class h{}e.Exp=h,e.NoopExp=class extends h{};class u extends h{constructor(t){super(),this.expression=t}}e.NegateExp=u;class p extends h{constructor(t){super(),this.expression=t}}e.BracketsExp=p;class f extends h{constructor(t){super(),this.value=t}}e.NumberExp=f;class d extends h{constructor(t){super(),this.value=t}}e.IdentifierExp=d;class g extends h{constructor(t,e,n){super(),this.left=t,this.right=e,this.op=n}}e.BinaryExp=g;class y extends h{constructor(t){super(),this.priority=function(t){return{[i.TokenType.tok_op_plus]:1,[i.TokenType.tok_op_minus]:1,[i.TokenType.tok_op_multiply]:2,[i.TokenType.tok_op_devide]:2,[i.TokenType.tok_op_modulo]:4,[i.TokenType.tok_op_power]:5}[t]}(t),this.op=t}}function m(){var t,e;if(l(i.TokenType.tok_eof)||l(i.TokenType.tok_close))return null;if([i.TokenType.tok_op_plus,i.TokenType.tok_op_minus,i.TokenType.tok_op_multiply,i.TokenType.tok_op_devide,i.TokenType.tok_op_modulo,i.TokenType.tok_op_power].includes(c().tokenType)){var n=c().tokenType;return a(),new y(n)}if(l(i.TokenType.tok_open))return function(){a();let t=x();return a(),new p(t)}();if(l(i.TokenType.tok_op_minus))return a(),new u(x());if(l(i.TokenType.tok_op_plus))return a(),m();if(l(i.TokenType.tok_identifier)){let e=(null===(t=c())||void 0===t?void 0:t.str)||"";return a(),new d(e)}let o=(null===(e=c())||void 0===e?void 0:e.value)||0;return a(),new f(o)}function x(){let t=null,e=[];for(;!l(i.TokenType.tok_eof)&&!l(i.TokenType.tok_close);)e.push(m());for(;e.length>1;){const t=(n=void 0,n=e.map((function(t){return t instanceof y?t.priority:0})),o=Math.max.apply(Math,n),n.indexOf(o)),i=e[t],r=e[t-1],s=e[t+1];e.splice(t-1,3,new g(r,s,i.op))}var n,o;return t=e[0],t||new f(0)}e.parseProgram=function(t){return o=(0,i.tokenize)(t),s=0,x()}},896:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EOF=e.strtod=e.isalpha=e.isalnum=e.isdigit=e.isspace=void 0,e.isspace=function(t){return/\s/.test(t)||""==t},e.isdigit=function(t){return/[0-9]/.test(t)},e.isalnum=function(t){return/[a-zA-Z0-9]/.test(t)},e.isalpha=function(t){return/[a-zA-Z]/.test(t)},e.strtod=function(t){let e=parseFloat(t);return isNaN(e)?0:e},e.EOF="\0"}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}var i={};return(()=>{var t=i;Object.defineProperty(t,"__esModule",{value:!0}),t.parseProgram=t.evaluate=t.execute=void 0;const e=n(215);Object.defineProperty(t,"parseProgram",{enumerable:!0,get:function(){return e.parseProgram}});const o=n(738);Object.defineProperty(t,"evaluate",{enumerable:!0,get:function(){return o.evaluate}});let r={};t.execute=function(t,n={}){let i="",s=0;try{let i=new e.NoopExp;r[t]?i=r[t]:(i=(0,e.parseProgram)(t),r[t]=i),s=(0,o.evaluate)(i,n)}catch(t){i=t.toString()}return{res:s,err:i}}})(),i})(),t.exports=e()}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";function t(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function e(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function i(t,e,n,i){return i?{x:(e.x-t.x+(i.x-n.x))/2,y:(e.y-t.y+(i.y-n.y))/2}:{x:e.x-t.x,y:e.y-t.y}}function o(e,n,i,o){if(!o)return 1;if(!i)return 1;let r=t(e,i),s=t(n,o);return r<.01?1:s/r}function r(t,e,n,i){if(!i)return 0;let o=s(t,n);return s(e,i)-o}function s(t,e){let n=i(t,e);return Math.atan2(n.y,n.x)}function a(n,s){this.deadzone=s,this.clear();let a=null,c=null,l=null,h=null,u=0,p=!0,f=!1,d=!1;this.centerPosition={x:0,y:0},this.debug=!1,this.console_error=!1,this.throw_error=!1,this.last_error="";const g=t=>{t.preventDefault();const{top:e,left:n}=t.target.getBoundingClientRect();if(t.touches[1]&&t.touches[0]){let i={x:t.touches[0].clientX-n,y:t.touches[0].clientY-e},o={x:t.touches[1].clientX-n,y:t.touches[1].clientY-e};return this.centerPosition={x:(i.x+o.x)/2,y:(i.y+o.y)/2},m(i,o)}if(t.touches[0]){let i={x:t.touches[0].clientX-n,y:t.touches[0].clientY-e};return this.centerPosition={x:i.x,y:i.y},m(i)}},y=t=>{t.preventDefault();const{top:e,left:n}=t.target.getBoundingClientRect();this.centerPosition={x:t.clientX-n,y:t.clientY-e},u&&m({x:t.clientX-n,y:t.clientY-e})},m=(n,s)=>{if(f=!0,null==a)return a={x:n.x,y:n.y},l={x:n.x,y:n.y},this.triger("start",l),void(p=!0);if(s&&null==c)return d=!0,t(a,s)<t(a,n)&&(a={x:n.x,y:n.y},l={x:n.x,y:n.y}),c={x:s.x,y:s.y},void(h={x:s.x,y:s.y});if(!s&&c)return d=!1,c=null,void(h=null);let g=i(l,n,h,s),y=o(l,n,h,s),m=r(l,n,h,s);l={x:n.x,y:n.y},h=s?{x:s.x,y:s.y}:null;let x=i(a,l,c,h),v=o(a,l,c,h),k=e(x),_=r(a,l,c,h),w=this.debug&&`${a&&"Start: "+JSON.stringify(a)},\n\t\t${l&&"This: "+JSON.stringify(l)}, \n\t\t${c&&"Start secound: "+JSON.stringify(c)}, \n\t\t${h&&"Start this: "+JSON.stringify(h)},\n\t\t${g&&"Delta: "+JSON.stringify(g)},\n\t\t${"Zoom: "+v},\n\t\t${"DZoom: "+y}\n\t\t${"Angle: "+_}\n\t\t${"DAngle: "+m}\n\t\t${"isPrimary: "+(!d&&0==u||1==u)}\n\t\t${this.last_error}`,T={delta:g,direction:x,startPosition:a,position:l,distance:k,click:p,isClick:p,mouseDown:u,zoom:v,deltaZoom:y,touchSecound:d,angle:_,deltaAngle:m,isPrimary:!d&&0==u||1==u,debug:w,centerPosition:this.centerPosition};this.triger("force",T),k>this.deadzone&&(p=!1,Math.abs(x.x)>Math.abs(x.y)?x.x>0?this.triger("right",T):this.triger("left",T):x.y>0?this.triger("down",T):this.triger("up",T))},x=t=>{if(t.preventDefault(),0==f)return;let n={x:0,y:0},s=i(a,l,c,h),g=o(a,l,c,h),y=r(a,l,c,h),m=e(s),x=this.debug&&`${a&&"Start: "+JSON.stringify(a)},\n\t\t${l&&"This: "+JSON.stringify(l)}, \n\t\t${c&&"Start secound: "+JSON.stringify(c)}, \n\t\t${h&&"Start this: "+JSON.stringify(h)},\n\t\t${n&&"Delta: "+JSON.stringify(n)},\n\t\t${"Zoom: "+g},\n\t\tDZoom: 0\n\t\t${"Angle: "+y}\n\t\tDAngle: 0\n\t\t${"isPrimary: "+(!d&&0==u||1==u)}\n\t\t${this.last_error}`;const v={x:a.x,y:a.y,delta:n,direction:s,startPosition:a,position:l,distance:m,click:p,isClick:p,mouseDown:u,zoom:g,deltaZoom:0,touchSecound:d,angle:y,deltaAngle:0,isPrimary:!d&&0==u||1==u,debug:x,centerPosition:this.centerPosition};f=!1,d=!1;let k=a;p&&(t.button?(1===t.button&&this.triger("bmiddle",v),2===t.button&&this.triger("bright",v)):k&&this.triger("click",v)),this.triger("stop",v),a=null,l=null,c=null,h=null,u=0};n.addEventListener("touchstart",(t=>{t.preventDefault()}),!1),n.addEventListener("touchmove",g,!1),n.addEventListener("touchend",x,!1),n.addEventListener("touchstart",g,!1),n.addEventListener("mouseleave",x,!1),n.addEventListener("mousemove",y),n.addEventListener("mouseup",x),n.addEventListener("mousedown",(t=>{u=1+t.button,y(t)}))}a.prototype.sub=function(t,e){this.events[t]&&this.events[t].push(e)},a.prototype.onClick=function(t){this.events.click.push(t)},a.prototype.onForce=function(t){this.events.force.push(t)},a.prototype.onStop=function(t){this.events.stop.push(t)},a.prototype.onUp=function(t){this.events.up.push(t)},a.prototype.onDown=function(t){this.events.down.push(t)},a.prototype.onLeft=function(t){this.events.left.push(t)},a.prototype.onRight=function(t){this.events.right.push(t)},a.prototype.unsub=function(t,e){this.events[t]&&(this.events[t]=this.events[t].filter((t=>t!==e)))},a.prototype.clearEvlent=function(t){this.events[t]&&(this.events[t]=[])},a.prototype.clear=function(){this.events={up:[],down:[],left:[],right:[],stop:[],start:[],click:[],force:[],bmiddle:[],bright:[]}},a.prototype.triger=function(t,e){this.events[t]&&this.events[t].forEach((t=>{try{t(e)}catch(t){if(this.console_error&&console.log(t),this.last_error="Error: "+t.name+" "+t.foo+" "+t.message+" "+t.stack,this.throw_error)throw t}}))};const c=a;function l(t,e,n,i,o,r,s){return[(r-t)*n+i/2,(s-e)*n+o/2]}function h(t,e,n,i,o,r,s){return[(r-i/2)/n+t,(s-o/2)/n+e]}function u(t){this.canvas=t,this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this.img=this.context.createImageData(this.canvas.width,this.canvas.height)}u.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},u.prototype.getCanvas=function(){return this.canvas},u.prototype.worldToScreen=function(t,e){const{width:n,height:i}=this.canvas,{x:o,y:r,scale:s}=t;return l(o,r,s,n,i,e[0],e[1])},u.prototype.screenToWorld=function(t,e){const{width:n,height:i}=this.canvas,{x:o,y:r,scale:s}=t;return h(o,r,s,n,i,e[0],e[1])};const p=u;function f(t,e){this.context=t,this.showCords=e?.showCords,this.showAxis=e?.showAxis,this.axisCords=e?.axisCords,this.axisScale=e?.axisScale||100,this.devide=e?.devide||2}f.prototype.draw=function(t,e,n){const{context:i}=this;var o=i.canvas.clientWidth,r=i.canvas.clientHeight;const{x:s,y:a,scale:c}=n,u=o/2,p=r/2;for(var f=c||1;f>2;)f/=2;for(;f<1;)f*=2;const d=t*f,g=e*f;var y;if((k=(u-s*c)%d)<0&&(k+=d),(_=(p-a*c)%g)<0&&(_+=g),this.showAxis){i.beginPath();let[t,e]=l(s,a,c,o,r,0,0);i.lineWidth=2,i.moveTo(t,0),i.lineTo(t,r),i.moveTo(0,e),i.lineTo(o,e),i.strokeStyle="rgba(0, 0, 0, 1.0)",i.stroke()}i.beginPath();for(var m=k;m<=o;m+=d){if(i.moveTo(m,0),i.lineTo(m,r),!this.axisCords)continue;let t=h(s,a,c,o,r,m,0)[0];this.drawCod(t,0,n,i)}for(var x=_;x<=r;x+=g){if(i.moveTo(0,x),i.lineTo(o,x),!this.axisCords)continue;let t=h(s,a,c,o,r,0,x)[1];this.drawCod(0,t,n,i)}i.lineWidth=2,i.strokeStyle="rgba(128, 128, 128, 0.5)",i.stroke();for(var v=0;v<this.devide-1;v++){var k=(k+d/this.devide)%d,_=(_+g/this.devide)%g;for(i.beginPath(),m=k;m<=o;m+=d)i.moveTo(m,0),i.lineTo(m,r);for(x=_;x<=r;x+=g)i.moveTo(0,x),i.lineTo(o,x);i.lineWidth=1,i.strokeStyle="rgba(128, 128, 128, "+(.25*(1-(y=f-1))+.5*y)+")",i.stroke()}this.showCords&&(i.font="10px Arial",i.fillText(Math.round(n.x*this.axisScale)/this.axisScale+Number.EPSILON+","+Math.round(n.y*this.axisScale+Number.EPSILON)/this.axisScale+","+Math.round(n.scale*this.axisScale+Number.EPSILON)/this.axisScale,10,50))},f.prototype.drawCod=function(t,e,n,i){const{x:o,y:r,scale:s}=n;var a=i.canvas.clientWidth,c=i.canvas.clientHeight,l=(t-o)*s+a/2,h=(e-r)*s+c/2;let u=!1;function p(t){return+parseFloat(t).toFixed(2)}(l<5||l>a-19||h>c-28||h<14)&&(u=!0),l<5&&(l=5),h<14&&(h=14),l>a-19&&(l=a-19),h>c-28&&(h=c-28),i.font="14px Verdana",i.fillStyle="rgb(0, 0, 0, 1.0)";let f="",d=p(t/this.axisScale),g=p(-e/this.axisScale);d&&(f+=d),g&&(f+=g),g||d||u||(f+="0"),i.fillText(f,l+5,h+14)},f.prototype.line=function(t,e,n,i,o){this.context.lineWidth=1,this.context.moveTo(t,e),this.context.lineTo(t+n,e+i),this.context.strokeStyle=o,this.context.stroke()};const d=f;function g(t){this.context=t,this.scale=100}g.prototype.draw=function(t,e,n){const{context:i}=this;var o=i.canvas.clientWidth,r=i.canvas.clientHeight;const{x:s,y:a,scale:c}=t,l=o/2,h=r/2;var u=(-s*c+l)%2;i.beginPath(),i.moveTo(p,0);for(var p=u;p<=o;p+=2){var f=(-e(((p-l)/c+s)/this.scale)*this.scale-a)*c+h;i.lineTo(p,f)}i.lineWidth=2,i.strokeStyle=n||"rgba(0, 0, 0, 1)",i.stroke()};const y=g;var m=n(453);function x(t,e){const n=new y(t.context);this.setProgram=t=>{this.func=n=>{let{res:i,err:o}=(0,m.execute)(t,{x:n});return o?(e.setBaloonText(o),console.log(o)):e.setBaloonText(""),i}},this.func=t=>t,this.work=function(t){n.draw(t,this.func,"black")}}function v(...t){if(Array.call(this),1==t.length){var e=t[0],n=Object.values(e);Object.hasOwnProperty.call(e,"length")&&e.length!==n.length&&n.pop(),this.push(...n)}else this.push(...Object.values(t));Object.defineProperty(this,"x",{get(){return this[0]},set(t){this[0]=t}}),Object.defineProperty(this,"y",{get(){return this[1]},set(t){this[1]=t}}),Object.defineProperty(this,"z",{get(){return this[2]},set(t){this[2]=t}})}function k(t,e){v.call(this),this.push(0,0,1,0),this.screen=t,Object.assign(this,e||{}),Object.defineProperty(this,"scale",{get(){return this[2]},set(t){this[2]=t}}),Object.defineProperty(this,"angle",{get(){return this[3]},set(t){this[3]=t}})}function _(t){this.id=t}function w(){this._generation={},this._free_indices=[],this._entities={},this._components={},this.__entities_with_type={}}function T(t){this.positions=new v(t)}function b(t,e){this.font=t,this.text=e}function S(t,e){this.x=t,this.y=e}function E(t){this.radius=t}function O(t){this.image=t}function P(t){this.radius=t}function N(t){this.rotate=t}function C(){this.noscale=!0}function j(t){this.scale=t}function W(t,e,n){this.color=t,this.stroke=e,this.layer=n||0}function M(t,e){this.context=t,this.manager=e,this.maxSize=100}function L(t,e){e.color&&(t.fillStyle=e.color,t.fill()),e.stroke&&(t.strokeStyle=e.stroke.color,t.lineWidth=e.stroke.width,t.stroke())}function z(t,e,n,i,o,r){t.moveTo(e,n+r),t.lineTo(e,n+o-r),t.arcTo(e,n+o,e+r,n+o,r),t.lineTo(e+i-r,n+o),t.arcTo(e+i,n+o,e+i,n+o-r,r),t.lineTo(e+i,n+r),t.arcTo(e+i,n,e+i-r,n,r),t.lineTo(e+r,n),t.arcTo(e,n,e,n+r,r)}function I(){this.isSelected=!1,this.index=0}v.prototype.x=0,v.prototype.y=0,v.prototype.z=0,v.prototype=Object.create(Array.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),v.prototype.add=function(t){let e=this.copy();for(var n=0;n<e.length;n++)Object.hasOwnProperty.call(e,n)&&Object.hasOwnProperty.call(t,n)&&(e[n]+=t[n]);return e},v.prototype.update=function(t){for(var e=0;e<this.length;e++)Object.hasOwnProperty.call(this,e)&&Object.hasOwnProperty.call(t,e)&&(this[e]=t[e])},v.prototype.negate=function(){let t=this.copy();for(var e=0;e<t.length;e++)Object.hasOwnProperty.call(t,e)&&(t[e]=-t[e]);return t},v.prototype.substract=function(t){return this.add(t.negate())},v.prototype.magnitude=function(){let t=0;for(var e=0;e<this.length;e++)Object.hasOwnProperty.call(this,e)&&(t+=this[e]*this[e]);return Math.sqrt(t)},v.prototype.normalise=function(t){let e=this.magnitude();return this.scale(1/e)},v.prototype.scale=function(t){let e=this.copy();for(var n=0;n<e.length;n++)Object.hasOwnProperty.call(e,n)&&(e[n]*=t);return e},v.prototype.copy=function(){return new this.constructor(this)},k.prototype=Object.create(v.prototype),k.prototype.zoom=function(t,e,n){if(this.scale*=t,!isNaN(this.minScale)&&this.scale<this.minScale)this.scale=this.minScale;else if(!isNaN(this.maxScale)&&this.scale>this.maxScale)this.scale=this.maxScale;else if(void 0!==e&&void 0!==n){let i=t-1,o=(this.screen.width/2-e)*i,r=(this.screen.height/2-n)*i;this.move(o,r)}},k.prototype.rotate=function(t){this.angle+=t},k.prototype.move=function(t,e){let n=t/this.scale,i=e/this.scale;this.x-=n,this.y-=i,!isNaN(this.minX)&&this.x<this.minX&&(this.x=this.minX),!isNaN(this.maxX)&&this.x>this.maxX&&(this.x=this.maxX),!isNaN(this.minY)&&this.y<this.minY&&(this.y=this.minY),!isNaN(this.maxY)&&this.y>this.maxY&&(this.y=this.maxY)},_.prototype.index=function(){return 4194303&this.id},_.prototype.generation=function(){return this.id>>22&255},w.prototype.create=function(){var t=0;this._free_indices.length>0?t=this._free_indices.shift():(t=Object.keys(this._generation).length,this._generation[t]=0);var e=this.make_entity(t,this._generation[t]);return this._entities[t]=e,e},w.prototype.make_entity=function(t,e){return new _(t+(e<<22))},w.prototype.alive=function(t){return this._generation[t.index()]==t.generation()},w.prototype.destroy=function(t){this._components[t.id]=void 0,this._entities[t.id]=void 0,++this._generation[t.index()],this._free_indices.push(t.index())},w.prototype.asign=function(t,e){var n=this._components[e.id];if(n){var i=n[t.constructor.name];if(i){if(i&&n[t.constructor.name].find((e=>t===e)))throw Error("Component is allready asiged");n[t.constructor.name].push(t)}else this._components[e.id][t.constructor.name]=[t]}else this._components[e.id]={[t.constructor.name]:[t]}},w.prototype.get=function(t,e){var n=this._components[e.id];return n&&n[t.name]||[]},w.prototype.remove=function(t,e){var n=this._components[e.id];n&&n[t.constructor.name]&&(n[t.constructor.name]=n[t.constructor.name].filter((function(e){return e!==t})))},w.prototype.getEnities=function(t){return Object.values(this._entities).filter((e=>e&&this.get(t,e).length))},M.prototype.draw=function(t){const{context:e}=this;var n=e.canvas.clientWidth,i=e.canvas.clientHeight;const{x:o,y:r,scale:s,angle:a}=t,c=n/2,l=i/2,h=this.maxSize*s;a&&(e.save(),e.translate(c,l),e.rotate(a),e.translate(-c,-l)),this.manager.getEnities(W).map((t=>[t,this.manager.get(W,t)[0]])).sort((([,t],[,e])=>t.layer<e.layer?-1:t.layer>e.layer?1:0)).map((([t,a])=>{var u=this.manager.get(T,t)[0],p=(u.positions[0]-o)*s+c,f=(u.positions[1]-r)*s+l;if(p<-h||f<-h||p>n||f>i)return;let d=this.manager.get(C,t)[0],g=this.manager.get(j,t)[0],y=d?1:s*(g?.scale||1),m=this.manager.get(E,t);for(let t in m){let n=m[t];const i=n.radius*y>1?n.radius*y:1;e.beginPath(),e.arc(p,f,i,0,2*Math.PI,!1),L(e,a)}let x=this.manager.get(S,t),v=this.manager.get(P,t),k=this.manager.get(N,t)[0];for(let t in x){let n=x[t];const i=n.x*y>1?n.x*y:1,o=n.y*y>1?n.y*y:1;e.save(),k&&(e.translate(p+i/2,f+o/2),e.rotate(k.rotate),e.translate(-p-i/2,-f-o/2)),e.beginPath(),v[0]?z(e,p,f,i,o,v[0].radius):e.rect(p,f,i,o),L(e,a),e.restore()}let _=this.manager.get(O,t);for(let t in _){let n=_[t],i=x[0],o=i?.x||n.image.width,r=i?.x||n.image.height;const s=o*y>1?o*y+.5:1,a=r*y>1?r*y+.5:1;e.save(),k&&(e.translate(p+s/2,f+a/2),e.rotate(k.rotate),e.translate(-p-s/2,-f-a/2)),e.drawImage(n.image,p,f,s,a),e.restore()}let w=this.manager.get(b,t);for(let t in w){let n=w[t];const i=n.font*y>1?n.font*y:1;e.fillStyle=a.color,e.font=parseInt(i)+"px serif",e.save(),k&&(e.translate(p,f),e.rotate(k.rotate),e.translate(-p,-f)),e.fillText(n.text,p,f+parseInt(i)),e.restore()}})),a&&e.restore()},M.prototype.mesure=function(t){const{context:e}=this;return e.font=parseInt(t.font)+"px serif",e.measureText(t.text)};const $=(t,e,n,i,o,r,s)=>{let a=t.create();return t.asign(new T([e,n]),a),t.asign(new S(i,o),a),t.asign(new W(r,s),a),t.asign(new P(5),a),a};function D(t,e){let n=t.split(/\r?\n/),i=[];for(let t of n){if(t.length<e){i.push(t);continue}let n=t.split(" "),o="";for(let t of n)t.length>e&&(t=t.slice(0,e-4),t+="..."),o.length+t.length>e&&(i.push(o.slice(1)),o=""),o+=" "+t;o.length&&i.push(o.slice(1))}return i}function A(){}function B(t,...e){e.forEach((e=>t.asign(new A,e)))}function X(t){this.checked=t}class Y{}class F{constructor(t){this.ploter=t,this.manager=new w,this.render=new M(this.ploter.context,this.manager),this.input_position=new k(t.canvas),this.stabilex=30,this.stabiley=30,this.inputs={},this.baloonText=""}getWith(){return this.ploter.canvas.width}getHeight(){return this.ploter.canvas.height}setResolution(){this.input_position.x=this.getWith()/2,this.input_position.y=this.getHeight()/2}touchClick({x:t,y:e}){var n=this.ploter.screenToWorld(this.input_position,[t,e]);const i=this.manager.getEnities(I).map((t=>{var e=this.manager.get(T,t)[0],n=this.manager.get(S,t)[0],i=this.manager.get(I,t)[0];return i.index=0,{transform:e,box:n,selectable:i,id:t}})).filter((({transform:t,box:e})=>function(t,e,n){return!(t[0]>n[0]||t[1]>n[1]||t[0]+e[0]<n[0]||t[1]+e[1]<n[1])}(t.positions,[e.x,e.y],n)))[0];if(i){let t=this.manager.get(X,i.id)[0];t&&this.setState(i.id,!t.checked)}return i}addTogle(t){let e=new b(20,t),n=this.render.mesure(e).width,i=this.manager.create();this.manager.asign(new T([this.stabilex,this.stabiley]),i),this.manager.asign(new S(n+10,30),i),this.manager.asign(new W("#555555"),i),this.manager.asign(new I,i),this.manager.asign(new X(!1),i),this.all.push(i);let o=this.manager.create();return this.manager.asign(new T([this.stabilex+5,this.stabiley]),o),this.manager.asign(e,o),this.manager.asign(new W("#cccccc"),o),this.all.push(o),this.stabilex+=n+15,this.inputs[t]=i,i}getCheckedByText(t){if(!this.inputs[t])return!1;let e=this.manager.get(X,this.inputs[t])[0];return!!e&&e.checked}setState(t,e){let n=this.manager.get(W,t)[0];n&&(n.color=e?"#888888":"#555555");let i=this.manager.get(X,t)[0];i&&(i.checked=e)}setBaloonText(t){if(this.baloonText==t)return;if(this.baloonText=t,this.manager.getEnities(Y).forEach((t=>{this.manager.destroy(t)})),!this.baloonText)return;let e=function(t,e,n,i,o){let r=[],s=o?.textSize||20,a=o?.lineHeight||s+10,c=o?.background||"#ffffffaa",l=o?.borderColor||"#ffffff",h=o?.borderWidth||1,u=o?.anchor||[0,0],p=o?.paddingX||o?.padding||10,f=o?.paddingY||o?.padding||10,d=o?.minWidth||0,g=o?.minHeight||0,y=o?.maxWidth||0,m=0,x=i.split(/\r?\n/).map((t=>{let n=new b(s,t),i=e.mesure(n).width,o=i+2*p;if(!y||o<y)return m=Math.max(i,m),[n];for(let n=t.length-1;0<n;n--){let i=D(t,n).map((t=>new b(s,t))),r=i.map((t=>e.mesure(t).width));if(o=Math.max(...r.map((t=>t+2*p))),o<y)return m=Math.max(m,...r),i}return[n]}));x=x.flat();let v=m+2*p;v=Math.max(d,v);let k=x.length*a+2*f;k=Math.max(g,k);let _=n[0]-v*u[0],w=n[1]-k*u[1],S=((t,e,n,i,o,r,s)=>{let a=s.width-1,c=$(t,e-a,n-a,i+2*a,o+2*a,null,{...s,width:a+2});return[$(t,e,n,i,o,r),c]})(t,_,w,v,k,c,{color:l,width:h});return r.push(...S),B(t,...S),x.map(((e,n)=>{let i=t.create();t.asign(new T([_+p,w+f+n*a]),i),t.asign(e,i),t.asign(new W("#000000",null,2),i),r.push(i),B(t,i)})),r}(this.manager,this.render,[this.getWith()-126,this.getHeight()-30],this.baloonText,{textSize:20,maxWidth:this.getWith()-136,minWidth:this.getWith()-136,anchor:[1,1],borderColor:"#aaaaaa",background:"#aaaaaaaa"});e.map((t=>this.manager.asign(new Y,t)))}work(){this.render.draw(this.input_position)}}var H=n(296),J=n.n(H);const Z=document.getElementById("phy_canvas");let R=()=>{},{work:q,adjustWindowSize:V,initGame:G}=function(t,e){var n=new p(t),i=new F(n),o=new k(t,{minX:-2e3,minY:-2e3,maxX:2e3,maxY:2e3,minScale:.15,maxScale:3}),r=new x(n,i),s=new c(t,20);s.throw_error=!0,window.addEventListener("mousewheel",(function(t){o.zoom(t.wheelDelta>0?1.1:.88,s.centerPosition.x,s.centerPosition.y)})),document.addEventListener("contextmenu",(function(t){t.preventDefault()}));let a=document.getElementById("program_text"),l=J()(r.setProgram,200);a.addEventListener("input",(t=>{l(t.target.value)}));const h=new d(n.context,{axisCords:!0,devide:4,showAxis:!0});let u=!1,f=!1;return s.onForce((t=>{var{delta:e,deltaZoom:n,isPrimary:i,centerPosition:r,position:s,isClick:a}=t;1!=n&&o.zoom(n,r.x,r.y),o.move(e.x,e.y)})),s.onStop((t=>{u=!1,f=!1})),s.onClick((t=>{i.touchClick(t)})),{work:function(){n.clear(),h.draw(100,100,o),r.work(o),i.work()},adjustWindowSize:function(){i.setResolution()},initGame:function(){r.initGame()}}}(Z);R=G,window.addEventListener("resize",(()=>{Z.width=window.innerWidth-10,Z.height=window.innerHeight-10,V()})),Z.width=window.innerWidth-10,Z.height=window.innerHeight-10,V();let U=()=>{q(),setTimeout(U,0)};U()})()})();